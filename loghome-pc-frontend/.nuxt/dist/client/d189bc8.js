(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{502:function(e,t,n){var map={"./af":361,"./af.js":361,"./ar":362,"./ar-dz":363,"./ar-dz.js":363,"./ar-kw":364,"./ar-kw.js":364,"./ar-ly":365,"./ar-ly.js":365,"./ar-ma":366,"./ar-ma.js":366,"./ar-ps":367,"./ar-ps.js":367,"./ar-sa":368,"./ar-sa.js":368,"./ar-tn":369,"./ar-tn.js":369,"./ar.js":362,"./az":370,"./az.js":370,"./be":371,"./be.js":371,"./bg":372,"./bg.js":372,"./bm":373,"./bm.js":373,"./bn":374,"./bn-bd":375,"./bn-bd.js":375,"./bn.js":374,"./bo":376,"./bo.js":376,"./br":377,"./br.js":377,"./bs":378,"./bs.js":378,"./ca":379,"./ca.js":379,"./cs":380,"./cs.js":380,"./cv":381,"./cv.js":381,"./cy":382,"./cy.js":382,"./da":383,"./da.js":383,"./de":384,"./de-at":385,"./de-at.js":385,"./de-ch":386,"./de-ch.js":386,"./de.js":384,"./dv":387,"./dv.js":387,"./el":388,"./el.js":388,"./en-au":389,"./en-au.js":389,"./en-ca":390,"./en-ca.js":390,"./en-gb":391,"./en-gb.js":391,"./en-ie":392,"./en-ie.js":392,"./en-il":393,"./en-il.js":393,"./en-in":394,"./en-in.js":394,"./en-nz":395,"./en-nz.js":395,"./en-sg":396,"./en-sg.js":396,"./eo":397,"./eo.js":397,"./es":398,"./es-do":399,"./es-do.js":399,"./es-mx":400,"./es-mx.js":400,"./es-us":401,"./es-us.js":401,"./es.js":398,"./et":402,"./et.js":402,"./eu":403,"./eu.js":403,"./fa":404,"./fa.js":404,"./fi":405,"./fi.js":405,"./fil":406,"./fil.js":406,"./fo":407,"./fo.js":407,"./fr":408,"./fr-ca":409,"./fr-ca.js":409,"./fr-ch":410,"./fr-ch.js":410,"./fr.js":408,"./fy":411,"./fy.js":411,"./ga":412,"./ga.js":412,"./gd":413,"./gd.js":413,"./gl":414,"./gl.js":414,"./gom-deva":415,"./gom-deva.js":415,"./gom-latn":416,"./gom-latn.js":416,"./gu":417,"./gu.js":417,"./he":418,"./he.js":418,"./hi":419,"./hi.js":419,"./hr":420,"./hr.js":420,"./hu":421,"./hu.js":421,"./hy-am":422,"./hy-am.js":422,"./id":423,"./id.js":423,"./is":424,"./is.js":424,"./it":425,"./it-ch":426,"./it-ch.js":426,"./it.js":425,"./ja":427,"./ja.js":427,"./jv":428,"./jv.js":428,"./ka":429,"./ka.js":429,"./kk":430,"./kk.js":430,"./km":431,"./km.js":431,"./kn":432,"./kn.js":432,"./ko":433,"./ko.js":433,"./ku":434,"./ku-kmr":435,"./ku-kmr.js":435,"./ku.js":434,"./ky":436,"./ky.js":436,"./lb":437,"./lb.js":437,"./lo":438,"./lo.js":438,"./lt":439,"./lt.js":439,"./lv":440,"./lv.js":440,"./me":441,"./me.js":441,"./mi":442,"./mi.js":442,"./mk":443,"./mk.js":443,"./ml":444,"./ml.js":444,"./mn":445,"./mn.js":445,"./mr":446,"./mr.js":446,"./ms":447,"./ms-my":448,"./ms-my.js":448,"./ms.js":447,"./mt":449,"./mt.js":449,"./my":450,"./my.js":450,"./nb":451,"./nb.js":451,"./ne":452,"./ne.js":452,"./nl":453,"./nl-be":454,"./nl-be.js":454,"./nl.js":453,"./nn":455,"./nn.js":455,"./oc-lnc":456,"./oc-lnc.js":456,"./pa-in":457,"./pa-in.js":457,"./pl":458,"./pl.js":458,"./pt":459,"./pt-br":460,"./pt-br.js":460,"./pt.js":459,"./ro":461,"./ro.js":461,"./ru":462,"./ru.js":462,"./sd":463,"./sd.js":463,"./se":464,"./se.js":464,"./si":465,"./si.js":465,"./sk":466,"./sk.js":466,"./sl":467,"./sl.js":467,"./sq":468,"./sq.js":468,"./sr":469,"./sr-cyrl":470,"./sr-cyrl.js":470,"./sr.js":469,"./ss":471,"./ss.js":471,"./sv":472,"./sv.js":472,"./sw":473,"./sw.js":473,"./ta":474,"./ta.js":474,"./te":475,"./te.js":475,"./tet":476,"./tet.js":476,"./tg":477,"./tg.js":477,"./th":478,"./th.js":478,"./tk":479,"./tk.js":479,"./tl-ph":480,"./tl-ph.js":480,"./tlh":481,"./tlh.js":481,"./tr":482,"./tr.js":482,"./tzl":483,"./tzl.js":483,"./tzm":484,"./tzm-latn":485,"./tzm-latn.js":485,"./tzm.js":484,"./ug-cn":486,"./ug-cn.js":486,"./uk":487,"./uk.js":487,"./ur":488,"./ur.js":488,"./uz":489,"./uz-latn":490,"./uz-latn.js":490,"./uz.js":489,"./vi":491,"./vi.js":491,"./x-pseudo":492,"./x-pseudo.js":492,"./yo":493,"./yo.js":493,"./zh-cn":494,"./zh-cn.js":494,"./zh-hk":495,"./zh-hk.js":495,"./zh-mo":496,"./zh-mo.js":496,"./zh-tw":497,"./zh-tw.js":497};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(map,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return map[e]}r.keys=function(){return Object.keys(map)},r.resolve=o,e.exports=r,r.id=502},519:function(e,t,n){var content=n(572);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(26).default)("208feb6c",content,!0,{sourceMap:!1})},571:function(e,t,n){"use strict";n(519)},572:function(e,t,n){var r=n(25)(!1);r.push([e.i,".chat-page[data-v-64badf73]{height:100vh;display:flex;flex-direction:column;background-color:#f5f5f5}.chat-header[data-v-64badf73]{background:#fff;padding:16px 20px;border-bottom:1px solid #eee;display:flex;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,.1)}.chat-header .back-button[data-v-64badf73]{margin-right:16px;cursor:pointer;padding:8px;border-radius:4px;transition:background-color .2s}.chat-header .back-button[data-v-64badf73]:hover{background-color:#f0f0f0}.chat-header .back-button i[data-v-64badf73]{font-size:20px;color:#666}.chat-header .chat-user-info[data-v-64badf73]{display:flex;align-items:center}.chat-header .chat-user-info .user-avatar[data-v-64badf73]{width:40px;height:40px;border-radius:50%;margin-right:12px;object-fit:cover}.chat-header .chat-user-info .user-details .username[data-v-64badf73]{margin:0;font-size:16px;font-weight:500;color:#333}.chat-header .chat-user-info .user-details .online-status[data-v-64badf73]{font-size:12px;color:#999}.chat-header .chat-user-info .user-details .online-status.online[data-v-64badf73]{color:#67c23a}.messages-container[data-v-64badf73]{flex:1;overflow-y:auto;padding:20px}.messages-container .messages-list[data-v-64badf73]{display:flex;flex-direction:column;gap:16px}.messages-container .message-item[data-v-64badf73]{display:flex;align-items:flex-start}.messages-container .message-item.own-message[data-v-64badf73]{flex-direction:row-reverse}.messages-container .message-item.own-message .message-content[data-v-64badf73]{align-items:flex-end}.messages-container .message-item.own-message .message-content .message-bubble[data-v-64badf73]{background-color:#409eff;color:#fff}.messages-container .message-item .message-avatar[data-v-64badf73]{margin:0 12px}.messages-container .message-item .message-avatar img[data-v-64badf73]{width:36px;height:36px;border-radius:50%;object-fit:cover}.messages-container .message-item .message-content[data-v-64badf73]{display:flex;flex-direction:column;align-items:flex-start;max-width:60%}.messages-container .message-item .message-content .message-bubble[data-v-64badf73]{background-color:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 2px 4px rgba(0,0,0,.1)}.messages-container .message-item .message-content .message-bubble .message-text[data-v-64badf73]{font-size:14px;line-height:1.5;white-space:pre-wrap;word-break:break-word}.messages-container .message-item .message-content .message-bubble .message-time[data-v-64badf73]{font-size:11px;color:hsla(0,0%,100%,.7);margin-top:4px;text-align:right}.messages-container .message-item:not(.own-message) .message-content .message-bubble .message-time[data-v-64badf73]{color:#999}.messages-container .empty-messages[data-v-64badf73]{text-align:center;padding:60px 20px;color:#999}.messages-container .empty-messages i[data-v-64badf73]{font-size:64px;margin-bottom:16px;display:block}.messages-container .empty-messages p[data-v-64badf73]{font-size:16px;margin:0}.message-input-container[data-v-64badf73]{background:#fff;border-top:1px solid #eee;padding:16px 20px}.message-input-container .input-wrapper[data-v-64badf73]{display:flex;align-items:flex-end;gap:12px}.message-input-container .input-wrapper .el-textarea[data-v-64badf73]{flex:1}.message-input-container .input-wrapper .input-actions[data-v-64badf73]{display:flex;align-items:center}@media(min-width: 1200px){.chat-page[data-v-64badf73]{max-width:1200px;margin:0 auto;box-shadow:0 0 20px rgba(0,0,0,.1)}.messages-container[data-v-64badf73]{padding:30px 40px}.message-item .message-content[data-v-64badf73]{max-width:50%}.message-input-container[data-v-64badf73]{padding:20px 40px}}@media(max-width: 1199px)and (min-width: 992px){.messages-container[data-v-64badf73]{padding:25px 30px}.message-item .message-content[data-v-64badf73]{max-width:55%}.message-input-container[data-v-64badf73]{padding:18px 30px}}@media(max-width: 991px)and (min-width: 768px){.messages-container[data-v-64badf73]{padding:20px 25px}.message-item .message-content[data-v-64badf73]{max-width:65%}.message-input-container[data-v-64badf73]{padding:16px 25px}.chat-header[data-v-64badf73]{padding:14px 20px}}@media(max-width: 767px){.chat-page[data-v-64badf73]{height:100vh}.messages-container[data-v-64badf73]{padding:16px}.message-item .message-content[data-v-64badf73]{max-width:80%}.message-item .message-avatar[data-v-64badf73]{margin:0 8px}.message-item .message-avatar img[data-v-64badf73]{width:32px;height:32px}.message-input-container[data-v-64badf73]{padding:12px 16px}.chat-header[data-v-64badf73]{padding:12px 16px}.chat-header .chat-user-info .user-avatar[data-v-64badf73]{width:36px;height:36px}.chat-header .chat-user-info .user-details .username[data-v-64badf73]{font-size:15px}}@media(max-width: 480px){.message-item .message-content[data-v-64badf73]{max-width:85%}.message-item .message-bubble[data-v-64badf73]{padding:10px 12px !important}.message-item .message-bubble .message-text[data-v-64badf73]{font-size:13px !important}.message-input-container[data-v-64badf73]{padding:10px 12px}.message-input-container .input-wrapper[data-v-64badf73]{gap:8px}.chat-header[data-v-64badf73]{padding:10px 12px}}",""]),e.exports=r},628:function(e,t,n){"use strict";n.r(t);var r=n(500),o=n(0),d=(n(6),n(357)),c=n.n(d),m={name:"ChatPage",data:function(){return{targetUserId:null,targetUser:{},messages:[],newMessage:"",sending:!1,loading:!1,myUserId:null,myUserInfo:{},page:1,hasMore:!0}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.targetUserId=e.$route.query.id,e.targetUserId){t.next=5;break}return e.$message.error("缺少用户ID参数"),e.goBack(),t.abrupt("return");case 5:return t.next=7,e.getCurrentUserInfo();case 7:return t.next=9,e.getTargetUserInfo();case 9:return t.next=11,e.loadMessages();case 11:e.$nextTick((function(){e.scrollToBottom()}));case 12:case"end":return t.stop()}}),t)})))()},methods:{getCurrentUserInfo:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{(n=localStorage.getItem("LogHomeUserInfo"))?(e.myUserInfo=JSON.parse(n),e.myUserId=e.myUserInfo.user_id):(e.$message.error("请先登录"),e.$router.push("/login"))}catch(t){console.error("获取用户信息失败",t),e.$message.error("获取用户信息失败")}case 1:case"end":return t.stop()}}),t)})))()},getTargetUserInfo:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.users.getUserInfo(e.targetUserId);case 3:if(0!==(n=t.sent).code){t.next=8;break}e.targetUser=n.data,t.next=9;break;case 8:throw new Error(n.message||"获取用户信息失败");case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("获取目标用户信息失败",t.t0),e.$message.error("获取用户信息失败");case 15:case"end":return t.stop()}}),t,null,[[0,11]])})))()},loadMessages:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.loading&&e.hasMore){t.next=2;break}return t.abrupt("return");case 2:return e.loading=!0,t.prev=3,t.next=6,e.$api.community.getMessagesList({target_id:e.targetUserId,page:e.page,limit:20});case 6:if(0!==(n=t.sent).code){t.next=14;break}o=n.data.list||[],1===e.page?e.messages=o:e.messages=[].concat(Object(r.a)(o),Object(r.a)(e.messages)),e.hasMore=20===o.length,e.page++,t.next=15;break;case 14:throw new Error(n.message||"加载消息失败");case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(3),console.error("加载消息失败",t.t0),e.$message.error("加载消息失败");case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,17,21,24]])})))()},sendMessage:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newMessage.trim()&&!e.sending){t.next=2;break}return t.abrupt("return");case 2:return n=e.newMessage.trim(),e.sending=!0,t.prev=4,t.next=7,e.$api.community.sendMessage({to_id:e.targetUserId,content:n,type:"text"});case 7:if(0!==(r=t.sent).code){t.next=15;break}o={message_id:Date.now(),from_id:e.myUserId,to_id:e.targetUserId,content:n,created_at:(new Date).toISOString(),is_read:0},e.messages.push(o),e.newMessage="",e.$nextTick((function(){e.scrollToBottom()})),t.next=16;break;case 15:throw new Error(r.message||"发送失败");case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(4),console.error("发送消息失败",t.t0),e.$message.error("发送失败，请重试");case 22:return t.prev=22,e.sending=!1,t.finish(22);case 25:case"end":return t.stop()}}),t,null,[[4,18,22,25]])})))()},addNewLine:function(){this.newMessage+="\n"},scrollToBottom:function(){var e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)},formatTime:function(time){return c()(time).format("MM-DD HH:mm")},goBack:function(){this.$router.go(-1)}}},l=(n(571),n(12)),component=Object(l.a)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-page"},[t("div",{staticClass:"chat-header"},[t("div",{staticClass:"back-button",on:{click:e.goBack}},[t("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),t("div",{staticClass:"chat-user-info"},[t("img",{staticClass:"user-avatar",attrs:{src:e.targetUser.avatar_url||"/default-avatar.png",alt:"头像"}}),e._v(" "),t("div",{staticClass:"user-details"},[t("h3",{staticClass:"username"},[e._v(e._s(e.targetUser.nickname||e.targetUser.username))]),e._v(" "),t("span",{staticClass:"online-status",class:{online:e.targetUser.is_online}},[e._v(e._s(e.targetUser.is_online?"在线":"离线"))])])])]),e._v(" "),t("div",{ref:"messagesContainer",staticClass:"messages-container"},[t("div",{staticClass:"messages-list"},e._l(e.messages,(function(n){return t("div",{key:n.message_id,staticClass:"message-item",class:{"own-message":n.from_id===e.myUserId}},[t("div",{staticClass:"message-avatar"},[t("img",{attrs:{src:n.from_id===e.myUserId?e.myUserInfo.avatar_url:e.targetUser.avatar_url,alt:"头像"}})]),e._v(" "),t("div",{staticClass:"message-content"},[t("div",{staticClass:"message-bubble"},[t("div",{staticClass:"message-text"},[e._v(e._s(n.content))]),e._v(" "),t("div",{staticClass:"message-time"},[e._v(e._s(e.formatTime(n.created_at)))])])])])})),0),e._v(" "),0===e.messages.length?t("div",{staticClass:"empty-messages"},[t("i",{staticClass:"el-icon-chat-dot-round"}),e._v(" "),t("p",[e._v("还没有消息，开始聊天吧！")])]):e._e()]),e._v(" "),t("div",{staticClass:"message-input-container"},[t("div",{staticClass:"input-wrapper"},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"输入消息...",maxlength:"500","show-word-limit":""},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.sendMessage.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.addNewLine.apply(null,arguments):null}]},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}}),e._v(" "),t("div",{staticClass:"input-actions"},[t("el-button",{attrs:{type:"primary",loading:e.sending,disabled:!e.newMessage.trim()},on:{click:e.sendMessage}},[e._v("\n          发送\n        ")])],1)],1)])])}),[],!1,null,"64badf73",null);t.default=component.exports}}]);