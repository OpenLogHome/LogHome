(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{526:function(e,t,r){var content=r(586);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(26).default)("54c595bf",content,!0,{sourceMap:!1})},585:function(e,t,r){"use strict";r(526)},586:function(e,t,r){var o=r(25)(!1);o.push([e.i,".info-edit-page[data-v-cd11f428]{width:100%;max-width:800px;margin:0 auto;padding:20px}.info-edit-page .page-header[data-v-cd11f428]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px}.info-edit-page .page-header .page-title[data-v-cd11f428]{font-size:28px;color:#704c35;margin:0}.info-edit-page .page-header .back-link[data-v-cd11f428]{color:#947358;text-decoration:none;font-size:16px}.info-edit-page .page-header .back-link[data-v-cd11f428]:hover{text-decoration:underline}.info-edit-page .info-edit-container[data-v-cd11f428]{background-color:#fff;border-radius:8px;padding:30px;box-shadow:0 2px 12px 0 rgba(0,0,0,.1);display:flex;flex-direction:column;gap:30px}.info-edit-page .cover-section[data-v-cd11f428]{display:flex;justify-content:center}.info-edit-page .cover-section .cover-preview[data-v-cd11f428]{width:200px;height:260px;border-radius:8px;overflow:hidden;position:relative;cursor:pointer;box-shadow:0 4px 12px rgba(0,0,0,.15)}.info-edit-page .cover-section .cover-preview:hover .cover-overlay[data-v-cd11f428]{opacity:1}.info-edit-page .cover-section .cover-preview .cover-overlay[data-v-cd11f428]{position:absolute;top:0;left:0;right:0;bottom:0;background-color:rgba(0,0,0,.5);display:flex;flex-direction:column;justify-content:center;align-items:center;opacity:0;transition:opacity .3s;color:#fff}.info-edit-page .cover-section .cover-preview .cover-overlay i[data-v-cd11f428]{font-size:32px;margin-bottom:10px}.info-edit-page .loading-state[data-v-cd11f428]{background-color:#fff;border-radius:8px;padding:40px;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,.1)}.info-edit-page .loading-state .loading-spinner[data-v-cd11f428]{width:50px;height:50px;border:5px solid #f5f5f5;border-top:5px solid #947358;border-radius:50%;margin:0 auto 20px;animation:spin-cd11f428 1s linear infinite}.info-edit-page .loading-state .loading-text[data-v-cd11f428]{color:#666}@keyframes spin-cd11f428{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}.info-edit-page .error-state[data-v-cd11f428]{background-color:#fff;border-radius:8px;padding:40px;text-align:center;box-shadow:0 2px 4px rgba(0,0,0,.1)}.info-edit-page .error-state .error-icon[data-v-cd11f428]{font-size:50px;margin-bottom:20px;color:#e74c3c}.info-edit-page .error-state .error-title[data-v-cd11f428]{font-size:20px;color:#333;margin-bottom:10px}.info-edit-page .error-state .error-desc[data-v-cd11f428]{color:#666;margin-bottom:25px}.info-edit-page .error-state .error-button[data-v-cd11f428]{background-color:#947358;color:#fff;border:none;border-radius:4px;padding:10px 30px;font-weight:600;cursor:pointer;transition:background-color .3s ease}.info-edit-page .error-state .error-button[data-v-cd11f428]:hover{background-color:#704c35}.upload-container[data-v-cd11f428]{display:flex;flex-direction:column;align-items:center;gap:20px}.upload-container .cover-uploader[data-v-cd11f428]{width:300px}.upload-container .cover-uploader .el-upload[data-v-cd11f428]{width:100%;border:1px dashed #d9d9d9;border-radius:6px;cursor:pointer;position:relative;overflow:hidden;text-align:center;padding:20px 0}.upload-container .cover-uploader .el-upload[data-v-cd11f428]:hover{border-color:#947358}.upload-container .cover-uploader .cover-uploader-icon[data-v-cd11f428]{font-size:28px;color:#8c939d;width:100%;height:100px;line-height:100px;text-align:center}.upload-container .cover-uploader .cover-preview-image[data-v-cd11f428]{max-width:100%;max-height:300px;display:block;margin:0 auto}.upload-container .cover-uploader .upload-tip[data-v-cd11f428]{color:#666;font-size:14px;margin-top:10px;line-height:1.5}.upload-container .upload-actions[data-v-cd11f428]{display:flex;justify-content:center;gap:20px;margin-top:20px}@media(max-width: 768px){.info-edit-page[data-v-cd11f428]{padding:10px}.info-edit-page .page-header .page-title[data-v-cd11f428]{font-size:24px}.info-edit-page .info-edit-container[data-v-cd11f428]{padding:20px}}",""]),e.exports=o},635:function(e,t,r){"use strict";r.r(t);var o=r(0),n=(r(27),r(107),r(6),{head:function(){return{title:"修改作品信息 - 原木社区"}},data:function(){return{loading:!0,error:null,submitting:!1,novelForm:{title:"",content:""},coverUrl:"",coverColor:"",coverDialogVisible:!1,coverFile:null,coverPreview:""}},computed:{coverStyle:function(){if(this.coverUrl)return{backgroundImage:"url(".concat(this.coverUrl,")"),backgroundSize:"cover",backgroundPosition:"center"};var e=["#a8d8ea","#aa96da","#c7ceea","#f6c3d5","#e4f9d4","#f9d4d4"];return this.coverColor=this.coverColor||e[Math.floor(Math.random()*e.length)],{backgroundColor:this.coverColor}}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.fetchNovelData();case 2:case"end":return t.stop()}}),t)})))()},methods:{fetchNovelData:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading=!0,e.error=null,t.prev=2,r=e.$route.params.id,t.next=6,e.$api.essays.getNovelById(r);case 6:(o=t.sent)&&o.length>0?(n=o[0],e.novelForm.title=n.name,e.novelForm.content=n.content,e.coverUrl=n.picUrl):e.error="未找到作品信息",t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),console.error("获取作品信息失败:",t.t0),e.error="获取作品信息失败，请稍后重试";case 14:return t.prev=14,e.loading=!1,t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[2,10,14,17]])})))()},openCoverUpload:function(){this.coverDialogVisible=!0,this.coverPreview=this.coverUrl,this.coverFile=null},beforeCoverUpload:function(e){var t=e.type.startsWith("image/"),r=e.size/1024/1024<2;return t?r?(this.coverFile=e,this.createCoverPreview(e),!1):(this.$message.error("图片大小不能超过 2MB!"),!1):(this.$message.error("只能上传图片文件!"),!1)},createCoverPreview:function(e){var t=this,r=new FileReader;r.onload=function(e){t.coverPreview=e.target.result},r.readAsDataURL(e)},uploadCover:function(){return Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},confirmCoverUpload:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.coverFile){t.next=3;break}return e.$message.warning("请先选择图片"),t.abrupt("return");case 3:try{e.submitting=!0,(r=new FileReader).readAsDataURL(e.coverFile),r.onload=Object(o.a)(regeneratorRuntime.mark((function t(){var o,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=r.result,n=e.$route.params.id,t.next=4,e.$api.essays.changeCover({img:o,novel_id:n});case 4:return e.$message.success("封面上传成功"),e.coverUrl=o,e.coverDialogVisible=!1,e.submitting=!1,t.next=10,e.fetchNovelData();case 10:case"end":return t.stop()}}),t)})))}catch(t){console.error("上传封面失败:",t),e.$message.error("上传封面失败，请稍后重试"),e.submitting=!1}case 4:case"end":return t.stop()}}),t)})))()},submitForm:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.novelForm.title.trim()){t.next=3;break}return e.$message.warning("请输入作品名称"),t.abrupt("return");case 3:if(e.novelForm.content.trim()){t.next=6;break}return e.$message.warning("请输入作品简介"),t.abrupt("return");case 6:return t.prev=6,e.submitting=!0,r=e.$route.params.id,t.next=11,e.$api.essays.modifyNovel(r,e.novelForm.title,e.novelForm.content);case 11:e.$message.success("作品信息修改成功"),e.$router.push("/write/settings/".concat(r)),t.next=19;break;case 15:t.prev=15,t.t0=t.catch(6),console.error("修改作品信息失败:",t.t0),e.$message.error("修改作品信息失败，请稍后重试");case 19:return t.prev=19,e.submitting=!1,t.finish(19);case 22:case"end":return t.stop()}}),t,null,[[6,15,19,22]])})))()}}}),c=(r(585),r(12)),component=Object(c.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"info-edit-page"},[t("div",{staticClass:"page-header"},[t("h1",{staticClass:"page-title"},[e._v("修改作品信息")]),e._v(" "),t("nuxt-link",{staticClass:"back-link",attrs:{to:"/write/settings/".concat(e.$route.params.id)}},[e._v("返回作品设置")])],1),e._v(" "),e.loading||e.error?e._e():t("div",{staticClass:"info-edit-container"},[t("div",{staticClass:"cover-section"},[t("div",{staticClass:"cover-preview",style:e.coverStyle,on:{click:e.openCoverUpload}},[e._m(0)])]),e._v(" "),t("div",{staticClass:"form-section"},[t("el-form",{attrs:{model:e.novelForm,"label-position":"top"}},[t("el-form-item",{attrs:{label:"作品名称",rules:[{required:!0,message:"请输入作品名称",trigger:"blur"}]}},[t("el-input",{attrs:{placeholder:"请输入作品名称",maxlength:"15","show-word-limit":""},model:{value:e.novelForm.title,callback:function(t){e.$set(e.novelForm,"title",t)},expression:"novelForm.title"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"作品简介",rules:[{required:!0,message:"请输入作品简介",trigger:"blur"}]}},[t("el-input",{attrs:{type:"textarea",placeholder:"请输入作品简介",rows:6,maxlength:"300","show-word-limit":""},model:{value:e.novelForm.content,callback:function(t){e.$set(e.novelForm,"content",t)},expression:"novelForm.content"}})],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.submitting},on:{click:e.submitForm}},[e._v("保存修改")]),e._v(" "),t("el-button",{on:{click:function(t){return e.$router.push("/write/settings/".concat(e.$route.params.id))}}},[e._v("取消")])],1)],1)],1)]),e._v(" "),e.loading?t("div",{staticClass:"loading-state"},[t("div",{staticClass:"loading-spinner"}),e._v(" "),t("p",{staticClass:"loading-text"},[e._v("正在加载作品信息...")])]):e.error?t("div",{staticClass:"error-state"},[t("div",{staticClass:"error-icon"},[e._v("❌")]),e._v(" "),t("h3",{staticClass:"error-title"},[e._v("加载失败")]),e._v(" "),t("p",{staticClass:"error-desc"},[e._v(e._s(e.error))]),e._v(" "),t("button",{staticClass:"error-button",on:{click:e.fetchNovelData}},[e._v("重试")])]):e._e(),e._v(" "),t("el-dialog",{attrs:{title:"上传封面",visible:e.coverDialogVisible,width:"50%"},on:{"update:visible":function(t){e.coverDialogVisible=t}}},[t("div",{staticClass:"upload-container"},[t("el-upload",{staticClass:"cover-uploader",attrs:{action:"","http-request":e.uploadCover,"show-file-list":!1,"before-upload":e.beforeCoverUpload}},[e.coverPreview?t("img",{staticClass:"cover-preview-image",attrs:{src:e.coverPreview}}):t("i",{staticClass:"el-icon-plus cover-uploader-icon"}),e._v(" "),t("div",{staticClass:"upload-tip"},[e._v("点击上传封面图片"),t("br"),e._v("建议尺寸: 741×962")])]),e._v(" "),t("div",{staticClass:"upload-actions"},[t("el-button",{on:{click:function(t){e.coverDialogVisible=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary",disabled:!e.coverFile},on:{click:e.confirmCoverUpload}},[e._v("确认上传")])],1)],1)])],1)}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"cover-overlay"},[t("i",{staticClass:"el-icon-camera"}),e._v(" "),t("span",[e._v("点击更换封面")])])}],!1,null,"cd11f428",null);t.default=component.exports}}]);