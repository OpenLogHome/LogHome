(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{528:function(t,e,r){var content=r(585);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,r(26).default)("0a18f48c",content,!0,{sourceMap:!1})},584:function(t,e,r){"use strict";r(528)},585:function(t,e,r){var n=r(25)(!1);n.push([t.i,".tags-edit-container[data-v-166c886e]{max-width:800px;margin:20px auto;padding:0 15px}.tags-edit-container .tags-card[data-v-166c886e]{margin-bottom:20px}.tags-edit-container .tags-card .card-header[data-v-166c886e]{display:flex;justify-content:space-between;align-items:center}.tags-edit-container .tags-card h3[data-v-166c886e]{font-size:16px;margin-bottom:15px;color:#947358;font-weight:600}.tags-edit-container .tags-card h3 .tag-count[data-v-166c886e]{font-size:14px;color:#999;font-weight:normal}.tags-edit-container .current-tags[data-v-166c886e],.tags-edit-container .suggested-tags[data-v-166c886e]{margin-bottom:25px}.tags-edit-container .tags-wrapper[data-v-166c886e]{display:flex;flex-wrap:wrap}.tags-edit-container .tags-wrapper .tag-item[data-v-166c886e]{margin-right:10px;margin-bottom:10px;cursor:default}.tags-edit-container .tags-wrapper .suggested-tag[data-v-166c886e]{cursor:pointer}.tags-edit-container .tags-wrapper .add-tag-btn[data-v-166c886e]{margin-bottom:10px}@media(max-width: 768px){.tags-edit-container[data-v-166c886e]{padding:0 10px}.tags-edit-container .el-dialog[data-v-166c886e]{width:90% !important}}",""]),t.exports=n},630:function(t,e,r){"use strict";r.r(e);var n=r(0),o=(r(6),{data:function(){return{novel_id:null,tags:[],suggested_tags:[],addTagDialogVisible:!1,newTagName:"",loading:!1,error:null}},asyncData:function(t){return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.params,t.$api,n=t.error,e.prev=1,o=r.id,e.abrupt("return",{novel_id:o,tags:[],suggested_tags:[]});case 6:e.prev=6,e.t0=e.catch(1),n({statusCode:404,message:"无法获取作品信息"});case 9:case"end":return e.stop()}}),e,null,[[1,6]])})))()},mounted:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.loading=!0,e.next=4,t.getNovelTags();case 4:return e.next=6,t.getSuggestedTags();case 6:e.next=12;break;case 8:e.prev=8,e.t0=e.catch(0),t.error=e.t0.message||"加载标签失败",t.$message.error(t.error);case 12:return e.prev=12,t.loading=!1,e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[0,8,12,15]])})))()},methods:{getNovelTags:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$api.library.getNovelTags(t.novel_id);case 3:r=e.sent,t.tags=r||[],console.log("获取标签成功:",t.tags),e.next=14;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("获取作品标签失败:",e.t0),t.$message.error((null===(n=e.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"获取作品标签失败"),t.tags=[],e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,8]])})))()},getSuggestedTags:function(){var t=this;return Object(n.a)(regeneratorRuntime.mark((function e(){var r,n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.$api.library.getSuggestedTags(t.novel_id);case 3:r=e.sent,t.suggested_tags=r||[],console.log("获取推荐标签成功:",t.suggested_tags),e.next=14;break;case 8:throw e.prev=8,e.t0=e.catch(0),console.error("获取推荐标签失败:",e.t0),t.$message.error((null===(n=e.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"获取推荐标签失败"),t.suggested_tags=[],e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,8]])})))()},deleteTag:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,e.$api.library.deleteNovelTag(e.novel_id,t);case 3:return e.$message.success("删除标签成功"),r.next=6,e.getNovelTags();case 6:return r.next=8,e.getSuggestedTags();case 8:r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),e.$message.error((null===(n=r.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"删除标签失败");case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()},addTag:function(t){var e=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t&&""!==t.trim()){r.next=3;break}return e.$message.warning("标签名称不能为空"),r.abrupt("return");case 3:return r.prev=3,r.next=6,e.$api.library.addNovelTag(e.novel_id,t.trim());case 6:return e.$message.success("添加标签成功"),e.newTagName="",e.addTagDialogVisible=!1,r.next=11,e.getNovelTags();case 11:return r.next=13,e.getSuggestedTags();case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(3),e.$message.error((null===(n=r.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"添加标签失败");case 18:case"end":return r.stop()}}),r,null,[[3,15]])})))()},showAddTagDialog:function(){this.newTagName="",this.addTagDialogVisible=!0},addCustomTag:function(){this.addTag(this.newTagName)},dealWithSuggested:function(t,e,r){var n=this.tags&&this.tags.length||0;!0===r?this.deleteTag(t):!1===r&&n<8?this.addTag(e):n>=8&&this.$message.warning("最多只能使用8个标签")},goBack:function(){this.$router.push("/write/settings/".concat(this.novel_id))}}}),c=(r(584),r(12)),component=Object(c.a)(o,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"tags-edit-container"},[e("el-card",{staticClass:"tags-card"},[e("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[e("span",[t._v("作品标签")]),t._v(" "),e("el-button",{attrs:{type:"text"},on:{click:t.goBack}},[t._v("返回")])],1),t._v(" "),e("div",{staticClass:"current-tags"},[e("h3",[t._v("当前标签 "),e("span",{staticClass:"tag-count"},[t._v("("+t._s(t.tags&&t.tags.length||0)+"/8)")])]),t._v(" "),e("div",{staticClass:"tags-wrapper"},[t._l(t.tags||[],(function(r){return e("el-tag",{key:r.tag_id,staticClass:"tag-item",attrs:{closable:"",type:r.is_activity_tag?"warning":"",effect:r.is_suggested?"plain":"light"},on:{close:function(e){return t.deleteTag(r.tag_id)}}},[t._v("\n          "+t._s(r.tag_name)+"\n        ")])})),t._v(" "),(t.tags&&t.tags.length||0)<8?e("el-button",{staticClass:"add-tag-btn",attrs:{size:"small",icon:"el-icon-plus"},on:{click:t.showAddTagDialog}},[t._v("\n          添加标签\n        ")]):t._e()],2)]),t._v(" "),e("div",{staticClass:"suggested-tags"},[e("h3",[t._v("官方标签")]),t._v(" "),e("div",{staticClass:"tags-wrapper"},t._l(t.suggested_tags||[],(function(r){return e("el-tag",{key:r.tag_id,staticClass:"tag-item suggested-tag",attrs:{type:r.is_activity_tag?"warning":"",effect:r.is_chosen||r.is_suggested?"plain":"light"},on:{click:function(e){return t.dealWithSuggested(r.tag_id,r.tag_name,r.is_chosen)}}},[t._v("\n          "+t._s(r.tag_name)+"\n        ")])})),1)])]),t._v(" "),e("el-dialog",{attrs:{title:"添加标签",visible:t.addTagDialogVisible,width:"30%",center:""},on:{"update:visible":function(e){t.addTagDialogVisible=e}}},[e("el-input",{attrs:{placeholder:"请输入标签名称",maxlength:"15","show-word-limit":""},model:{value:t.newTagName,callback:function(e){t.newTagName=e},expression:"newTagName"}}),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.addTagDialogVisible=!1}}},[t._v("取 消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.addCustomTag}},[t._v("确 定")])],1)],1)],1)}),[],!1,null,"166c886e",null);e.default=component.exports}}]);