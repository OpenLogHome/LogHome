(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{527:function(e,t,r){var content=r(588);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(26).default)("32ea6afe",content,!0,{sourceMap:!1})},587:function(e,t,r){"use strict";r(527)},588:function(e,t,r){var n=r(25)(!1);n.push([e.i,".tags-edit-container[data-v-166c886e]{max-width:800px;margin:20px auto;padding:0 15px}.tags-edit-container .tags-card[data-v-166c886e]{margin-bottom:20px}.tags-edit-container .tags-card .card-header[data-v-166c886e]{display:flex;justify-content:space-between;align-items:center}.tags-edit-container .tags-card h3[data-v-166c886e]{font-size:16px;margin-bottom:15px;color:#947358;font-weight:600}.tags-edit-container .tags-card h3 .tag-count[data-v-166c886e]{font-size:14px;color:#999;font-weight:normal}.tags-edit-container .current-tags[data-v-166c886e],.tags-edit-container .suggested-tags[data-v-166c886e]{margin-bottom:25px}.tags-edit-container .tags-wrapper[data-v-166c886e]{display:flex;flex-wrap:wrap}.tags-edit-container .tags-wrapper .tag-item[data-v-166c886e]{margin-right:10px;margin-bottom:10px;cursor:default}.tags-edit-container .tags-wrapper .suggested-tag[data-v-166c886e]{cursor:pointer}.tags-edit-container .tags-wrapper .add-tag-btn[data-v-166c886e]{margin-bottom:10px}@media(max-width: 768px){.tags-edit-container[data-v-166c886e]{padding:0 10px}.tags-edit-container .el-dialog[data-v-166c886e]{width:90% !important}}",""]),e.exports=n},636:function(e,t,r){"use strict";r.r(t);var n=r(0),o=(r(6),{data:function(){return{novel_id:null,tags:[],suggested_tags:[],addTagDialogVisible:!1,newTagName:"",loading:!1,error:null}},asyncData:function(e){return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.params,e.$api,n=e.error,t.prev=1,o=r.id,t.abrupt("return",{novel_id:o,tags:[],suggested_tags:[]});case 6:t.prev=6,t.t0=t.catch(1),n({statusCode:404,message:"无法获取作品信息"});case 9:case"end":return t.stop()}}),t,null,[[1,6]])})))()},mounted:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.loading=!0,t.next=4,e.getNovelTags();case 4:return t.next=6,e.getSuggestedTags();case 6:t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),e.error=t.t0.message||"加载标签失败",e.$message.error(e.error);case 12:return t.prev=12,e.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[0,8,12,15]])})))()},methods:{getNovelTags:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.library.getNovelTags(e.novel_id);case 3:r=t.sent,e.tags=r||[],console.log("获取标签成功:",e.tags),t.next=14;break;case 8:throw t.prev=8,t.t0=t.catch(0),console.error("获取作品标签失败:",t.t0),e.$message.error((null===(n=t.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"获取作品标签失败"),e.tags=[],t.t0;case 14:case"end":return t.stop()}}),t,null,[[0,8]])})))()},getSuggestedTags:function(){var e=this;return Object(n.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.library.getSuggestedTags(e.novel_id);case 3:r=t.sent,e.suggested_tags=r||[],console.log("获取推荐标签成功:",e.suggested_tags),t.next=14;break;case 8:throw t.prev=8,t.t0=t.catch(0),console.error("获取推荐标签失败:",t.t0),e.$message.error((null===(n=t.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"获取推荐标签失败"),e.suggested_tags=[],t.t0;case 14:case"end":return t.stop()}}),t,null,[[0,8]])})))()},deleteTag:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.library.deleteNovelTag(t.novel_id,e);case 3:return t.$message.success("删除标签成功"),r.next=6,t.getNovelTags();case 6:return r.next=8,t.getSuggestedTags();case 8:r.next=13;break;case 10:r.prev=10,r.t0=r.catch(0),t.$message.error((null===(n=r.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"删除标签失败");case 13:case"end":return r.stop()}}),r,null,[[0,10]])})))()},addTag:function(e){var t=this;return Object(n.a)(regeneratorRuntime.mark((function r(){var n;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(e&&""!==e.trim()){r.next=3;break}return t.$message.warning("标签名称不能为空"),r.abrupt("return");case 3:return r.prev=3,r.next=6,t.$api.library.addNovelTag(t.novel_id,e.trim());case 6:return t.$message.success("添加标签成功"),t.newTagName="",t.addTagDialogVisible=!1,r.next=11,t.getNovelTags();case 11:return r.next=13,t.getSuggestedTags();case 13:r.next=18;break;case 15:r.prev=15,r.t0=r.catch(3),t.$message.error((null===(n=r.t0.response)||void 0===n||null===(n=n.data)||void 0===n?void 0:n.msg)||"添加标签失败");case 18:case"end":return r.stop()}}),r,null,[[3,15]])})))()},showAddTagDialog:function(){this.newTagName="",this.addTagDialogVisible=!0},addCustomTag:function(){this.addTag(this.newTagName)},dealWithSuggested:function(e,t,r){var n=this.tags&&this.tags.length||0;!0===r?this.deleteTag(e):!1===r&&n<8?this.addTag(t):n>=8&&this.$message.warning("最多只能使用8个标签")},goBack:function(){this.$router.push("/write/settings/".concat(this.novel_id))}}}),c=(r(587),r(12)),component=Object(c.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"tags-edit-container"},[t("el-card",{staticClass:"tags-card"},[t("div",{staticClass:"card-header",attrs:{slot:"header"},slot:"header"},[t("span",[e._v("作品标签")]),e._v(" "),t("el-button",{attrs:{type:"text"},on:{click:e.goBack}},[e._v("返回")])],1),e._v(" "),t("div",{staticClass:"current-tags"},[t("h3",[e._v("当前标签 "),t("span",{staticClass:"tag-count"},[e._v("("+e._s(e.tags&&e.tags.length||0)+"/8)")])]),e._v(" "),t("div",{staticClass:"tags-wrapper"},[e._l(e.tags||[],(function(r){return t("el-tag",{key:r.tag_id,staticClass:"tag-item",attrs:{closable:"",type:r.is_activity_tag?"warning":"",effect:r.is_suggested?"plain":"light"},on:{close:function(t){return e.deleteTag(r.tag_id)}}},[e._v("\n          "+e._s(r.tag_name)+"\n        ")])})),e._v(" "),(e.tags&&e.tags.length||0)<8?t("el-button",{staticClass:"add-tag-btn",attrs:{size:"small",icon:"el-icon-plus"},on:{click:e.showAddTagDialog}},[e._v("\n          添加标签\n        ")]):e._e()],2)]),e._v(" "),t("div",{staticClass:"suggested-tags"},[t("h3",[e._v("官方标签")]),e._v(" "),t("div",{staticClass:"tags-wrapper"},e._l(e.suggested_tags||[],(function(r){return t("el-tag",{key:r.tag_id,staticClass:"tag-item suggested-tag",attrs:{type:r.is_activity_tag?"warning":"",effect:r.is_chosen||r.is_suggested?"plain":"light"},on:{click:function(t){return e.dealWithSuggested(r.tag_id,r.tag_name,r.is_chosen)}}},[e._v("\n          "+e._s(r.tag_name)+"\n        ")])})),1)])]),e._v(" "),t("el-dialog",{attrs:{title:"添加标签",visible:e.addTagDialogVisible,width:"30%",center:""},on:{"update:visible":function(t){e.addTagDialogVisible=t}}},[t("el-input",{attrs:{placeholder:"请输入标签名称",maxlength:"15","show-word-limit":""},model:{value:e.newTagName,callback:function(t){e.newTagName=t},expression:"newTagName"}}),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.addTagDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addCustomTag}},[e._v("确 定")])],1)],1)],1)}),[],!1,null,"166c886e",null);t.default=component.exports}}]);