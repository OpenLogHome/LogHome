(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{531:function(e,t,r){var content=r(591);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(26).default)("4cea0ea6",content,!0,{sourceMap:!1})},590:function(e,t,r){"use strict";r(531)},591:function(e,t,r){var o=r(25)(!1);o.push([e.i,".write-edit-page[data-v-03c3e330]{width:100%;min-height:100vh;background-color:#fafafa;display:flex;flex-direction:column}.write-edit-page .edit-container[data-v-03c3e330]{flex:1;max-width:2400px;width:100%;display:flex;flex-direction:column}.write-edit-page .edit-container .split-layout[data-v-03c3e330]{display:flex;height:100%;min-height:100vh;flex:1}.write-edit-page .edit-container .left-panel[data-v-03c3e330]{flex:0 0 auto;background-color:#fff;display:flex;flex-direction:column;overflow:hidden}.write-edit-page .edit-container .resize-handle[data-v-03c3e330]{width:4px;background-color:#ddd;cursor:col-resize;transition:background-color .2s ease}.write-edit-page .edit-container .resize-handle[data-v-03c3e330]:hover{background-color:#947358}.write-edit-page .edit-container .expand-button[data-v-03c3e330]{width:13px;height:100vh;background-color:#ddd;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:background-color .2s ease}.write-edit-page .edit-container .expand-button svg[data-v-03c3e330]{width:16px;height:16px;color:#fff}.write-edit-page .edit-container .expand-button[data-v-03c3e330]:hover{background-color:#704c35}.write-edit-page .edit-container .drag-overlay[data-v-03c3e330]{position:fixed;top:0;left:0;right:0;bottom:0;z-index:9999;cursor:col-resize}.write-edit-page .edit-container .right-panel[data-v-03c3e330]{flex:1;background-color:#fff;display:flex;flex-direction:column;overflow:hidden}.write-edit-page .edit-container .micro-app-container[data-v-03c3e330]{flex:1;position:relative;overflow:hidden}.write-edit-page .edit-container .micro-app-container .mobile-iframe[data-v-03c3e330]{width:100%;height:100%;border:none;display:block}.write-edit-page .edit-container .micro-app-container .loading-container[data-v-03c3e330]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%}.write-edit-page .edit-container .micro-app-container .loading-container .loading-spinner[data-v-03c3e330]{width:40px;height:40px;border:4px solid #f5f5f5;border-top:4px solid #947358;border-radius:50%;animation:spin-03c3e330 1s linear infinite;margin-bottom:16px}.write-edit-page .edit-container .micro-app-container .loading-container .loading-text[data-v-03c3e330]{color:#666;font-size:14px;margin:0}.write-edit-page .edit-container .editor-container[data-v-03c3e330]{flex:1;display:flex;flex-direction:column;overflow:hidden}.write-edit-page .edit-container .editor-container .editor-header[data-v-03c3e330]{display:flex;align-items:center;justify-content:space-between;padding:3px 20px;background-color:#f5f5f5;border-bottom:1px solid #eee}.write-edit-page .edit-container .editor-container .editor-header .editor-title[data-v-03c3e330]{display:flex;align-items:center;gap:8px}.write-edit-page .edit-container .editor-container .editor-header .editor-title .editor-icon[data-v-03c3e330]{font-size:18px}.write-edit-page .edit-container .editor-container .editor-header .editor-title .title-text[data-v-03c3e330]{font-size:16px;font-weight:600;color:#333}.write-edit-page .edit-container .editor-container .editor-header .editor-title .article-type-tag[data-v-03c3e330]{background-color:#947358;color:#fff;padding:2px 8px;border-radius:12px;font-size:12px;font-weight:500}.write-edit-page .edit-container .editor-container .editor-header .close-editor-btn[data-v-03c3e330]{width:32px;height:32px;border:none;background-color:rgba(0,0,0,0);cursor:pointer;border-radius:4px;display:flex;align-items:center;justify-content:center;transition:background-color .2s ease}.write-edit-page .edit-container .editor-container .editor-header .close-editor-btn svg[data-v-03c3e330]{width:18px;height:18px;color:#666}.write-edit-page .edit-container .editor-container .editor-header .close-editor-btn[data-v-03c3e330]:hover{background-color:#eee}.write-edit-page .edit-container .editor-container .editor-iframe[data-v-03c3e330]{flex:1;width:100%;border:none;display:block}.write-edit-page .edit-container .empty-content[data-v-03c3e330]{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.write-edit-page .edit-container .empty-content .empty-icon[data-v-03c3e330]{font-size:64px;margin-bottom:20px;opacity:.6}.write-edit-page .edit-container .empty-content .empty-title[data-v-03c3e330]{font-size:20px;font-weight:600;color:#333;margin:0 0 12px 0}.write-edit-page .edit-container .empty-content .empty-desc[data-v-03c3e330]{font-size:16px;color:#666;margin:0;line-height:1.6}.write-edit-page .edit-container .work-info[data-v-03c3e330]{background-color:#fff;border-radius:8px;padding:30px;box-shadow:0 2px 8px rgba(0,0,0,.1)}.write-edit-page .edit-container .work-info .work-id-display[data-v-03c3e330]{color:#666;font-size:14px;margin-bottom:30px;padding:10px 15px;background-color:#f5f5f5;border-radius:4px;border-left:3px solid #947358}.write-edit-page .edit-container .work-info .placeholder-content[data-v-03c3e330]{text-align:center;padding:60px 20px}.write-edit-page .edit-container .work-info .placeholder-content .placeholder-icon[data-v-03c3e330]{font-size:64px;margin-bottom:20px}.write-edit-page .edit-container .work-info .placeholder-content .placeholder-title[data-v-03c3e330]{font-size:24px;color:#333;margin-bottom:15px;font-weight:600}.write-edit-page .edit-container .work-info .placeholder-content .placeholder-desc[data-v-03c3e330]{color:#666;font-size:16px;line-height:1.6}.write-edit-page .edit-container .loading-state[data-v-03c3e330]{background-color:#fff;border-radius:8px;padding:60px 30px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.1);margin:auto;max-width:500px}.write-edit-page .edit-container .loading-state .loading-spinner[data-v-03c3e330]{width:40px;height:40px;border:4px solid #f5f5f5;border-top:4px solid #947358;border-radius:50%;animation:spin-03c3e330 1s linear infinite;margin:0 auto 20px auto}.write-edit-page .edit-container .loading-state .loading-text[data-v-03c3e330]{color:#666;font-size:16px;margin:0;line-height:1.6}.write-edit-page .edit-container .error-state[data-v-03c3e330]{background-color:#fff;border-radius:8px;padding:60px 30px;text-align:center;box-shadow:0 2px 8px rgba(0,0,0,.1);margin:auto;max-width:500px}.write-edit-page .edit-container .error-state .error-icon[data-v-03c3e330]{font-size:64px;margin-bottom:20px}.write-edit-page .edit-container .error-state .error-title[data-v-03c3e330]{font-size:24px;color:#333;margin-bottom:15px;font-weight:600}.write-edit-page .edit-container .error-state .error-desc[data-v-03c3e330]{color:#666;font-size:16px;margin-bottom:30px;line-height:1.6}.write-edit-page .edit-container .error-state .error-button[data-v-03c3e330]{background-color:#947358;color:#fff;border:none;border-radius:6px;padding:12px 24px;font-size:16px;font-weight:600;cursor:pointer;transition:background-color .3s ease}.write-edit-page .edit-container .error-state .error-button[data-v-03c3e330]:hover{background-color:#704c35}@keyframes spin-03c3e330{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@media(max-width: 1024px){.write-edit-page .edit-container .split-layout[data-v-03c3e330]{flex-direction:column}.write-edit-page .edit-container .resize-handle[data-v-03c3e330]{display:none}.write-edit-page .edit-container .left-panel[data-v-03c3e330],.write-edit-page .edit-container .right-panel[data-v-03c3e330]{min-height:400px}}@media(max-width: 768px){.write-edit-page .edit-container[data-v-03c3e330]{padding:15px}.write-edit-page .edit-container .split-layout[data-v-03c3e330]{flex-direction:column}.write-edit-page .edit-container .resize-handle[data-v-03c3e330]{display:none}.write-edit-page .edit-container .empty-content[data-v-03c3e330]{padding:40px 15px}.write-edit-page .edit-container .empty-content .empty-icon[data-v-03c3e330]{font-size:48px}.write-edit-page .edit-container .empty-content .empty-title[data-v-03c3e330]{font-size:18px}.write-edit-page .edit-container .work-info[data-v-03c3e330],.write-edit-page .edit-container .loading-state[data-v-03c3e330],.write-edit-page .edit-container .error-state[data-v-03c3e330]{padding:30px 20px}.write-edit-page .edit-container .work-info .placeholder-content[data-v-03c3e330],.write-edit-page .edit-container .loading-state .placeholder-content[data-v-03c3e330],.write-edit-page .edit-container .error-state .placeholder-content[data-v-03c3e330]{padding:40px 15px}.write-edit-page .edit-container .work-info .placeholder-content .placeholder-icon[data-v-03c3e330],.write-edit-page .edit-container .loading-state .placeholder-content .placeholder-icon[data-v-03c3e330],.write-edit-page .edit-container .error-state .placeholder-content .placeholder-icon[data-v-03c3e330]{font-size:48px}.write-edit-page .edit-container .work-info .placeholder-content .placeholder-title[data-v-03c3e330],.write-edit-page .edit-container .loading-state .placeholder-content .placeholder-title[data-v-03c3e330],.write-edit-page .edit-container .error-state .placeholder-content .placeholder-title[data-v-03c3e330]{font-size:20px}.write-edit-page .edit-container .work-info .placeholder-content .placeholder-desc[data-v-03c3e330],.write-edit-page .edit-container .loading-state .placeholder-content .placeholder-desc[data-v-03c3e330],.write-edit-page .edit-container .error-state .placeholder-content .placeholder-desc[data-v-03c3e330]{font-size:14px}.write-edit-page .edit-container .loading-state[data-v-03c3e330]{padding:40px 20px}.write-edit-page .edit-container .loading-state .loading-spinner[data-v-03c3e330]{width:32px;height:32px}.write-edit-page .edit-container .loading-state .loading-text[data-v-03c3e330]{font-size:14px}.write-edit-page .edit-container .error-state[data-v-03c3e330]{padding:40px 20px}.write-edit-page .edit-container .error-state .error-icon[data-v-03c3e330]{font-size:48px}.write-edit-page .edit-container .error-state .error-title[data-v-03c3e330]{font-size:20px}.write-edit-page .edit-container .error-state .error-desc[data-v-03c3e330]{font-size:14px}}",""]),e.exports=o},633:function(e,t,r){"use strict";r.r(t);var o=r(0),n=(r(6),{layout:"empty",head:function(){return{title:"写作编辑器 - 原木社区"}},data:function(){return{workId:null,token:null,panelUrl:"",microAppData:{},leftPanelWidth:400,isResizing:!1,startX:0,startWidth:0,isLeftPanelHidden:!1,currentEditingArticle:null,rightPanelContent:"empty",isInitializing:!0}},created:function(){if(this.workId=this.$route.params.id,!this.workId||"undefined"===this.workId)return console.error("无效的作品ID:",this.workId),this.workId=null,void(this.isInitializing=!1);console.log("当前编辑的作品ID:",this.workId)},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.workId){t.next=4;break}return t.next=3,e.initializeMobileApp();case 3:window.addEventListener("message",e.handleIframeMessage);case 4:e.isInitializing=!1;case 5:case"end":return t.stop()}}),t)})))()},beforeDestroy:function(){window.removeEventListener("message",this.handleIframeMessage)},methods:{initializeMobileApp:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!localStorage.getItem("token")){t.next=12;break}return t.next=5,e.$api.users.generateCrossSiteToken();case 5:r=t.sent,e.token=r.crossSiteToken,o=encodeURIComponent("/pages/writers/allArticles?id=".concat(e.workId)),e.panelUrl="".concat("https://m.loghome.ink","/#/pages/users/external_login?token=").concat(e.token,"&hideback=true&redirectTo=").concat(o),console.log("移动端URL:",e.panelUrl),t.next=13;break;case 12:console.error("未找到token");case 13:t.next=18;break;case 15:t.prev=15,t.t0=t.catch(0),console.error("初始化移动端应用失败:",t.t0);case 18:case"end":return t.stop()}}),t,null,[[0,15]])})))()},goBack:function(){this.$router.go(-1)},onMicroAppMounted:function(e){console.log("micro-app mounted:",e)},onMicroAppUnmount:function(e){console.log("micro-app unmount:",e)},onMicroAppError:function(e){console.error("micro-app error:",e)},startResize:function(e){this.isResizing=!0,this.startX=e.clientX,this.startWidth=this.leftPanelWidth,document.addEventListener("mousemove",this.handleResize),document.addEventListener("mouseup",this.stopResize),document.body.style.cursor="col-resize",document.body.style.userSelect="none"},handleResize:function(e){if(this.isResizing){var t=e.clientX-this.startX,r=this.startWidth+t;if(r<100)return this.isLeftPanelHidden=!0,void this.stopResize();r>=100&&r<=400&&(this.leftPanelWidth=r)}},stopResize:function(){this.isResizing=!1,document.removeEventListener("mousemove",this.handleResize),document.removeEventListener("mouseup",this.stopResize),document.body.style.cursor="",document.body.style.userSelect=""},showLeftPanel:function(){this.isLeftPanelHidden=!1,this.leftPanelWidth=200},handleIframeMessage:function(e){if(console.log("父框架收到iframe消息:",e.data),"iframe_ready"===e.data.type&&"allArticles"===e.data.source){console.log("收到移动端编辑器准备就绪消息，发送确认");var iframe=document.querySelector(".mobile-iframe");iframe&&iframe.contentWindow&&(iframe.contentWindow.postMessage({type:"frame_confirmed",source:"parentFrame",message:"父框架已确认通信"},"*"),console.log("已向iframe发送确认消息"))}else if("iframe_ready"===e.data.type&&"chapterEditor"===e.data.source){console.log("收到章节编辑器准备就绪消息，发送确认");var t=document.querySelector(".editor-iframe");t&&t.contentWindow&&(t.contentWindow.postMessage({type:"frame_confirmed",target:"chapterEditor",source:"parentFrame",message:"父框架已确认通信"},"*"),console.log("已向章节编辑器iframe发送确认消息"))}else if("frame_enabled"===e.data.type&&"allArticles"===e.data.source)console.log("iframe模式已成功启用:",e.data.message);else if("current_selected"===e.data.type&&"chapterEditor"===e.data.source){console.log("收到章节编辑器当前选中文章消息:",e.data.data);var r=document.querySelector(".mobile-iframe");r&&r.contentWindow&&(r.contentWindow.postMessage({type:"current_selected",source:"parentFrame",data:e.data.data},"*"),console.log("已转发当前选中文章消息给allArticles"))}else"edit_article"===e.data.type&&"allArticles"===e.data.source&&(console.log("收到文章编辑请求:",e.data.data),this.handleArticleEdit(e.data.data))},handleArticleEdit:function(e){this.currentEditingArticle=e,this.rightPanelContent="editor",console.log("开始编辑文章:",e.title,"类型:",e.article_type);var t="";if("worldVocabulary"===e.article_type?t="/pages/writers/worldVocabularyEditor?id=".concat(e.article_id):"spliter"!==e.article_type&&(t="/pages/writers/chapterEditor?id=".concat(e.article_id)),t){var r="".concat("https://m.loghome.ink","/#").concat(t,"&hideback=true&token=").concat(this.token);this.$nextTick((function(){var e=document.querySelector(".editor-iframe");e&&(e.src=r)}))}},getArticleTypeLabel:function(e){return{richtext:"章节",worldOutline:"大纲",worldVocabulary:"词条",spliter:"分卷"}[e]||"文章"},closeEditor:function(){this.rightPanelContent="empty",this.currentEditingArticle=null;var iframe=document.querySelector(".mobile-iframe");iframe&&iframe.contentWindow&&(iframe.contentWindow.postMessage({type:"clear_selection",source:"parentFrame",message:"编辑器已关闭，取消文章选中状态"},"*"),console.log("已向左侧面板发送取消选中消息")),console.log("关闭编辑器")}}}),d=(r(590),r(12)),component=Object(d.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"write-edit-page"},[t("div",{staticClass:"edit-container"},[e.isInitializing?t("div",{staticClass:"loading-state"},[t("div",{staticClass:"loading-spinner"}),e._v(" "),t("p",{staticClass:"loading-text"},[e._v("正在初始化编辑器...")])]):e.workId?t("div",{staticClass:"split-layout"},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLeftPanelHidden,expression:"!isLeftPanelHidden"}],staticClass:"left-panel",style:{width:e.leftPanelWidth+"px"}},[t("div",{staticClass:"micro-app-container"},[e.panelUrl?t("iframe",{staticClass:"mobile-iframe",attrs:{src:e.panelUrl,frameborder:"0"}}):t("div",{staticClass:"loading-container"},[t("div",{staticClass:"loading-spinner"}),e._v(" "),t("p",{staticClass:"loading-text"},[e._v("正在加载编辑器...")])])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLeftPanelHidden,expression:"!isLeftPanelHidden"}],staticClass:"resize-handle",on:{mousedown:e.startResize}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isLeftPanelHidden,expression:"isLeftPanelHidden"}],staticClass:"expand-button",on:{click:e.showLeftPanel}},[t("svg",{attrs:{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M9 18L15 12L9 6",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])]),e._v(" "),t("div",{staticClass:"right-panel"},["editor"===e.rightPanelContent?t("div",{staticClass:"editor-container"},[t("div",{staticClass:"editor-header"},[t("div",{staticClass:"editor-title"},[t("span",{staticClass:"title-text"},[e._v(e._s(e.currentEditingArticle?e.currentEditingArticle.title:"编辑器"))]),e._v(" "),e.currentEditingArticle?t("span",{staticClass:"article-type-tag"},[e._v("\n                "+e._s(e.getArticleTypeLabel(e.currentEditingArticle.article_type))+"\n              ")]):e._e()]),e._v(" "),t("button",{staticClass:"close-editor-btn",on:{click:e.closeEditor}},[t("svg",{attrs:{viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg"}},[t("path",{attrs:{d:"M18 6L6 18M6 6L18 18",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"}})])])]),e._v(" "),t("iframe",{staticClass:"editor-iframe",attrs:{frameborder:"0"}})]):t("div",{staticClass:"empty-content"},[t("div",{staticClass:"empty-icon"},[e._v("📝")]),e._v(" "),t("h4",{staticClass:"empty-title"},[e._v("选择文章开始编辑")]),e._v(" "),t("p",{staticClass:"empty-desc"},[e._v("在左侧选择要编辑的文章，编辑器将在此处显示")])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isResizing,expression:"isResizing"}],staticClass:"drag-overlay"})]):t("div",{staticClass:"error-state"},[t("div",{staticClass:"error-icon"},[e._v("❌")]),e._v(" "),t("h3",{staticClass:"error-title"},[e._v("无效的作品")]),e._v(" "),t("p",{staticClass:"error-desc"},[e._v("未能获取到有效的作品，请返回重新选择作品")]),e._v(" "),t("button",{staticClass:"error-button",on:{click:e.goBack}},[e._v("返回作品列表")])])])])}),[],!1,null,"03c3e330",null);t.default=component.exports}}]);