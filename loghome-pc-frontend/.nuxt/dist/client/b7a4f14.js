(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{504:function(e,t,n){var map={"./af":363,"./af.js":363,"./ar":364,"./ar-dz":365,"./ar-dz.js":365,"./ar-kw":366,"./ar-kw.js":366,"./ar-ly":367,"./ar-ly.js":367,"./ar-ma":368,"./ar-ma.js":368,"./ar-ps":369,"./ar-ps.js":369,"./ar-sa":370,"./ar-sa.js":370,"./ar-tn":371,"./ar-tn.js":371,"./ar.js":364,"./az":372,"./az.js":372,"./be":373,"./be.js":373,"./bg":374,"./bg.js":374,"./bm":375,"./bm.js":375,"./bn":376,"./bn-bd":377,"./bn-bd.js":377,"./bn.js":376,"./bo":378,"./bo.js":378,"./br":379,"./br.js":379,"./bs":380,"./bs.js":380,"./ca":381,"./ca.js":381,"./cs":382,"./cs.js":382,"./cv":383,"./cv.js":383,"./cy":384,"./cy.js":384,"./da":385,"./da.js":385,"./de":386,"./de-at":387,"./de-at.js":387,"./de-ch":388,"./de-ch.js":388,"./de.js":386,"./dv":389,"./dv.js":389,"./el":390,"./el.js":390,"./en-au":391,"./en-au.js":391,"./en-ca":392,"./en-ca.js":392,"./en-gb":393,"./en-gb.js":393,"./en-ie":394,"./en-ie.js":394,"./en-il":395,"./en-il.js":395,"./en-in":396,"./en-in.js":396,"./en-nz":397,"./en-nz.js":397,"./en-sg":398,"./en-sg.js":398,"./eo":399,"./eo.js":399,"./es":400,"./es-do":401,"./es-do.js":401,"./es-mx":402,"./es-mx.js":402,"./es-us":403,"./es-us.js":403,"./es.js":400,"./et":404,"./et.js":404,"./eu":405,"./eu.js":405,"./fa":406,"./fa.js":406,"./fi":407,"./fi.js":407,"./fil":408,"./fil.js":408,"./fo":409,"./fo.js":409,"./fr":410,"./fr-ca":411,"./fr-ca.js":411,"./fr-ch":412,"./fr-ch.js":412,"./fr.js":410,"./fy":413,"./fy.js":413,"./ga":414,"./ga.js":414,"./gd":415,"./gd.js":415,"./gl":416,"./gl.js":416,"./gom-deva":417,"./gom-deva.js":417,"./gom-latn":418,"./gom-latn.js":418,"./gu":419,"./gu.js":419,"./he":420,"./he.js":420,"./hi":421,"./hi.js":421,"./hr":422,"./hr.js":422,"./hu":423,"./hu.js":423,"./hy-am":424,"./hy-am.js":424,"./id":425,"./id.js":425,"./is":426,"./is.js":426,"./it":427,"./it-ch":428,"./it-ch.js":428,"./it.js":427,"./ja":429,"./ja.js":429,"./jv":430,"./jv.js":430,"./ka":431,"./ka.js":431,"./kk":432,"./kk.js":432,"./km":433,"./km.js":433,"./kn":434,"./kn.js":434,"./ko":435,"./ko.js":435,"./ku":436,"./ku-kmr":437,"./ku-kmr.js":437,"./ku.js":436,"./ky":438,"./ky.js":438,"./lb":439,"./lb.js":439,"./lo":440,"./lo.js":440,"./lt":441,"./lt.js":441,"./lv":442,"./lv.js":442,"./me":443,"./me.js":443,"./mi":444,"./mi.js":444,"./mk":445,"./mk.js":445,"./ml":446,"./ml.js":446,"./mn":447,"./mn.js":447,"./mr":448,"./mr.js":448,"./ms":449,"./ms-my":450,"./ms-my.js":450,"./ms.js":449,"./mt":451,"./mt.js":451,"./my":452,"./my.js":452,"./nb":453,"./nb.js":453,"./ne":454,"./ne.js":454,"./nl":455,"./nl-be":456,"./nl-be.js":456,"./nl.js":455,"./nn":457,"./nn.js":457,"./oc-lnc":458,"./oc-lnc.js":458,"./pa-in":459,"./pa-in.js":459,"./pl":460,"./pl.js":460,"./pt":461,"./pt-br":462,"./pt-br.js":462,"./pt.js":461,"./ro":463,"./ro.js":463,"./ru":464,"./ru.js":464,"./sd":465,"./sd.js":465,"./se":466,"./se.js":466,"./si":467,"./si.js":467,"./sk":468,"./sk.js":468,"./sl":469,"./sl.js":469,"./sq":470,"./sq.js":470,"./sr":471,"./sr-cyrl":472,"./sr-cyrl.js":472,"./sr.js":471,"./ss":473,"./ss.js":473,"./sv":474,"./sv.js":474,"./sw":475,"./sw.js":475,"./ta":476,"./ta.js":476,"./te":477,"./te.js":477,"./tet":478,"./tet.js":478,"./tg":479,"./tg.js":479,"./th":480,"./th.js":480,"./tk":481,"./tk.js":481,"./tl-ph":482,"./tl-ph.js":482,"./tlh":483,"./tlh.js":483,"./tr":484,"./tr.js":484,"./tzl":485,"./tzl.js":485,"./tzm":486,"./tzm-latn":487,"./tzm-latn.js":487,"./tzm.js":486,"./ug-cn":488,"./ug-cn.js":488,"./uk":489,"./uk.js":489,"./ur":490,"./ur.js":490,"./uz":491,"./uz-latn":492,"./uz-latn.js":492,"./uz.js":491,"./vi":493,"./vi.js":493,"./x-pseudo":494,"./x-pseudo.js":494,"./yo":495,"./yo.js":495,"./zh-cn":496,"./zh-cn.js":496,"./zh-hk":497,"./zh-hk.js":497,"./zh-mo":498,"./zh-mo.js":498,"./zh-tw":499,"./zh-tw.js":499};function r(e){var t=o(e);return n(t)}function o(e){if(!n.o(map,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return map[e]}r.keys=function(){return Object.keys(map)},r.resolve=o,e.exports=r,r.id=504},521:function(e,t,n){var content=n(571);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(26).default)("443403b8",content,!0,{sourceMap:!1})},570:function(e,t,n){"use strict";n(521)},571:function(e,t,n){var r=n(25)(!1);r.push([e.i,".chat-page[data-v-64badf73]{height:100vh;display:flex;flex-direction:column;background-color:#f5f5f5}.chat-header[data-v-64badf73]{background:#fff;padding:16px 20px;border-bottom:1px solid #eee;display:flex;align-items:center;box-shadow:0 2px 4px rgba(0,0,0,.1)}.chat-header .back-button[data-v-64badf73]{margin-right:16px;cursor:pointer;padding:8px;border-radius:4px;transition:background-color .2s}.chat-header .back-button[data-v-64badf73]:hover{background-color:#f0f0f0}.chat-header .back-button i[data-v-64badf73]{font-size:20px;color:#666}.chat-header .chat-user-info[data-v-64badf73]{display:flex;align-items:center}.chat-header .chat-user-info .user-avatar[data-v-64badf73]{width:40px;height:40px;border-radius:50%;margin-right:12px;object-fit:cover}.chat-header .chat-user-info .user-details .username[data-v-64badf73]{margin:0;font-size:16px;font-weight:500;color:#333}.chat-header .chat-user-info .user-details .online-status[data-v-64badf73]{font-size:12px;color:#999}.chat-header .chat-user-info .user-details .online-status.online[data-v-64badf73]{color:#67c23a}.messages-container[data-v-64badf73]{flex:1;overflow-y:auto;padding:20px}.messages-container .messages-list[data-v-64badf73]{display:flex;flex-direction:column;gap:16px}.messages-container .message-item[data-v-64badf73]{display:flex;align-items:flex-start}.messages-container .message-item.own-message[data-v-64badf73]{flex-direction:row-reverse}.messages-container .message-item.own-message .message-content[data-v-64badf73]{align-items:flex-end}.messages-container .message-item.own-message .message-content .message-bubble[data-v-64badf73]{background-color:#409eff;color:#fff}.messages-container .message-item .message-avatar[data-v-64badf73]{margin:0 12px}.messages-container .message-item .message-avatar img[data-v-64badf73]{width:36px;height:36px;border-radius:50%;object-fit:cover}.messages-container .message-item .message-content[data-v-64badf73]{display:flex;flex-direction:column;align-items:flex-start;max-width:60%}.messages-container .message-item .message-content .message-bubble[data-v-64badf73]{background-color:#fff;border-radius:12px;padding:12px 16px;box-shadow:0 2px 4px rgba(0,0,0,.1)}.messages-container .message-item .message-content .message-bubble .message-text[data-v-64badf73]{font-size:14px;line-height:1.5;white-space:pre-wrap;word-break:break-word}.messages-container .message-item .message-content .message-bubble .message-time[data-v-64badf73]{font-size:11px;color:hsla(0,0%,100%,.7);margin-top:4px;text-align:right}.messages-container .message-item:not(.own-message) .message-content .message-bubble .message-time[data-v-64badf73]{color:#999}.messages-container .empty-messages[data-v-64badf73]{text-align:center;padding:60px 20px;color:#999}.messages-container .empty-messages i[data-v-64badf73]{font-size:64px;margin-bottom:16px;display:block}.messages-container .empty-messages p[data-v-64badf73]{font-size:16px;margin:0}.message-input-container[data-v-64badf73]{background:#fff;border-top:1px solid #eee;padding:16px 20px}.message-input-container .input-wrapper[data-v-64badf73]{display:flex;align-items:flex-end;gap:12px}.message-input-container .input-wrapper .el-textarea[data-v-64badf73]{flex:1}.message-input-container .input-wrapper .input-actions[data-v-64badf73]{display:flex;align-items:center}@media(min-width: 1200px){.chat-page[data-v-64badf73]{max-width:1200px;margin:0 auto;box-shadow:0 0 20px rgba(0,0,0,.1)}.messages-container[data-v-64badf73]{padding:30px 40px}.message-item .message-content[data-v-64badf73]{max-width:50%}.message-input-container[data-v-64badf73]{padding:20px 40px}}@media(max-width: 1199px)and (min-width: 992px){.messages-container[data-v-64badf73]{padding:25px 30px}.message-item .message-content[data-v-64badf73]{max-width:55%}.message-input-container[data-v-64badf73]{padding:18px 30px}}@media(max-width: 991px)and (min-width: 768px){.messages-container[data-v-64badf73]{padding:20px 25px}.message-item .message-content[data-v-64badf73]{max-width:65%}.message-input-container[data-v-64badf73]{padding:16px 25px}.chat-header[data-v-64badf73]{padding:14px 20px}}@media(max-width: 767px){.chat-page[data-v-64badf73]{height:100vh}.messages-container[data-v-64badf73]{padding:16px}.message-item .message-content[data-v-64badf73]{max-width:80%}.message-item .message-avatar[data-v-64badf73]{margin:0 8px}.message-item .message-avatar img[data-v-64badf73]{width:32px;height:32px}.message-input-container[data-v-64badf73]{padding:12px 16px}.chat-header[data-v-64badf73]{padding:12px 16px}.chat-header .chat-user-info .user-avatar[data-v-64badf73]{width:36px;height:36px}.chat-header .chat-user-info .user-details .username[data-v-64badf73]{font-size:15px}}@media(max-width: 480px){.message-item .message-content[data-v-64badf73]{max-width:85%}.message-item .message-bubble[data-v-64badf73]{padding:10px 12px !important}.message-item .message-bubble .message-text[data-v-64badf73]{font-size:13px !important}.message-input-container[data-v-64badf73]{padding:10px 12px}.message-input-container .input-wrapper[data-v-64badf73]{gap:8px}.chat-header[data-v-64badf73]{padding:10px 12px}}",""]),e.exports=r},623:function(e,t,n){"use strict";n.r(t);var r=n(502),o=n(0),d=(n(6),n(359)),c=n.n(d),m={name:"ChatPage",data:function(){return{targetUserId:null,targetUser:{},messages:[],newMessage:"",sending:!1,loading:!1,myUserId:null,myUserInfo:{},page:1,hasMore:!0}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.targetUserId=e.$route.query.id,e.targetUserId){t.next=5;break}return e.$message.error("缺少用户ID参数"),e.goBack(),t.abrupt("return");case 5:return t.next=7,e.getCurrentUserInfo();case 7:return t.next=9,e.getTargetUserInfo();case 9:return t.next=11,e.loadMessages();case 11:e.$nextTick((function(){e.scrollToBottom()}));case 12:case"end":return t.stop()}}),t)})))()},methods:{getCurrentUserInfo:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{(n=localStorage.getItem("LogHomeUserInfo"))?(e.myUserInfo=JSON.parse(n),e.myUserId=e.myUserInfo.user_id):(e.$message.error("请先登录"),e.$router.push("/login"))}catch(t){console.error("获取用户信息失败",t),e.$message.error("获取用户信息失败")}case 1:case"end":return t.stop()}}),t)})))()},getTargetUserInfo:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.users.getUserInfo(e.targetUserId);case 3:if(0!==(n=t.sent).code){t.next=8;break}e.targetUser=n.data,t.next=9;break;case 8:throw new Error(n.message||"获取用户信息失败");case 9:t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("获取目标用户信息失败",t.t0),e.$message.error("获取用户信息失败");case 15:case"end":return t.stop()}}),t,null,[[0,11]])})))()},loadMessages:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.loading&&e.hasMore){t.next=2;break}return t.abrupt("return");case 2:return e.loading=!0,t.prev=3,t.next=6,e.$api.community.getMessagesList({target_id:e.targetUserId,page:e.page,limit:20});case 6:if(0!==(n=t.sent).code){t.next=14;break}o=n.data.list||[],1===e.page?e.messages=o:e.messages=[].concat(Object(r.a)(o),Object(r.a)(e.messages)),e.hasMore=20===o.length,e.page++,t.next=15;break;case 14:throw new Error(n.message||"加载消息失败");case 15:t.next=21;break;case 17:t.prev=17,t.t0=t.catch(3),console.error("加载消息失败",t.t0),e.$message.error("加载消息失败");case 21:return t.prev=21,e.loading=!1,t.finish(21);case 24:case"end":return t.stop()}}),t,null,[[3,17,21,24]])})))()},sendMessage:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.newMessage.trim()&&!e.sending){t.next=2;break}return t.abrupt("return");case 2:return n=e.newMessage.trim(),e.sending=!0,t.prev=4,t.next=7,e.$api.community.sendMessage({to_id:e.targetUserId,content:n,type:"text"});case 7:if(0!==(r=t.sent).code){t.next=15;break}o={message_id:Date.now(),from_id:e.myUserId,to_id:e.targetUserId,content:n,created_at:(new Date).toISOString(),is_read:0},e.messages.push(o),e.newMessage="",e.$nextTick((function(){e.scrollToBottom()})),t.next=16;break;case 15:throw new Error(r.message||"发送失败");case 16:t.next=22;break;case 18:t.prev=18,t.t0=t.catch(4),console.error("发送消息失败",t.t0),e.$message.error("发送失败，请重试");case 22:return t.prev=22,e.sending=!1,t.finish(22);case 25:case"end":return t.stop()}}),t,null,[[4,18,22,25]])})))()},addNewLine:function(){this.newMessage+="\n"},scrollToBottom:function(){var e=this.$refs.messagesContainer;e&&(e.scrollTop=e.scrollHeight)},formatTime:function(time){return c()(time).format("MM-DD HH:mm")},goBack:function(){this.$router.go(-1)}}},l=(n(570),n(12)),component=Object(l.a)(m,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"chat-page"},[t("div",{staticClass:"chat-header"},[t("div",{staticClass:"back-button",on:{click:e.goBack}},[t("i",{staticClass:"el-icon-arrow-left"})]),e._v(" "),t("div",{staticClass:"chat-user-info"},[t("img",{staticClass:"user-avatar",attrs:{src:e.targetUser.avatar_url||"/default-avatar.png",alt:"头像"}}),e._v(" "),t("div",{staticClass:"user-details"},[t("h3",{staticClass:"username"},[e._v(e._s(e.targetUser.nickname||e.targetUser.username))]),e._v(" "),t("span",{staticClass:"online-status",class:{online:e.targetUser.is_online}},[e._v(e._s(e.targetUser.is_online?"在线":"离线"))])])])]),e._v(" "),t("div",{ref:"messagesContainer",staticClass:"messages-container"},[t("div",{staticClass:"messages-list"},e._l(e.messages,(function(n){return t("div",{key:n.message_id,staticClass:"message-item",class:{"own-message":n.from_id===e.myUserId}},[t("div",{staticClass:"message-avatar"},[t("img",{attrs:{src:n.from_id===e.myUserId?e.myUserInfo.avatar_url:e.targetUser.avatar_url,alt:"头像"}})]),e._v(" "),t("div",{staticClass:"message-content"},[t("div",{staticClass:"message-bubble"},[t("div",{staticClass:"message-text"},[e._v(e._s(n.content))]),e._v(" "),t("div",{staticClass:"message-time"},[e._v(e._s(e.formatTime(n.created_at)))])])])])})),0),e._v(" "),0===e.messages.length?t("div",{staticClass:"empty-messages"},[t("i",{staticClass:"el-icon-chat-dot-round"}),e._v(" "),t("p",[e._v("还没有消息，开始聊天吧！")])]):e._e()]),e._v(" "),t("div",{staticClass:"message-input-container"},[t("div",{staticClass:"input-wrapper"},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"输入消息...",maxlength:"500","show-word-limit":""},on:{keydown:[function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e.sendMessage.apply(null,arguments))},function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:t.ctrlKey?e.addNewLine.apply(null,arguments):null}]},model:{value:e.newMessage,callback:function(t){e.newMessage=t},expression:"newMessage"}}),e._v(" "),t("div",{staticClass:"input-actions"},[t("el-button",{attrs:{type:"primary",loading:e.sending,disabled:!e.newMessage.trim()},on:{click:e.sendMessage}},[e._v("\n          发送\n        ")])],1)],1)])])}),[],!1,null,"64badf73",null);t.default=component.exports}}]);