(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{520:function(e,t,r){var content=r(574);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(26).default)("2b34746c",content,!0,{sourceMap:!1})},573:function(e,t,r){"use strict";r(520)},574:function(e,t,r){var c=r(25)(!1);c.push([e.i,".circles-container[data-v-3625361c]{max-width:1200px;margin:0 auto;padding:20px;min-height:100vh}.page-header[data-v-3625361c]{text-align:center;margin-bottom:30px}.page-header .page-title[data-v-3625361c]{font-size:32px;font-weight:bold;color:#333;margin-bottom:8px}.page-header .page-subtitle[data-v-3625361c]{font-size:16px;color:#666;margin:0}.search-section[data-v-3625361c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:30px;gap:20px}.search-section .search-box[data-v-3625361c]{display:flex;flex:1;max-width:500px}.search-section .search-box .search-input[data-v-3625361c]{flex:1;height:40px;padding:0 15px;border:1px solid #ddd;border-radius:20px 0 0 20px;font-size:14px;outline:none}.search-section .search-box .search-input[data-v-3625361c]:focus{border-color:#ea7034}.search-section .search-box .search-btn[data-v-3625361c]{width:50px;height:40px;background-color:#ea7034;border:none;border-radius:0 20px 20px 0;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center}.search-section .search-box .search-btn[data-v-3625361c]:hover{background-color:#d65a2b}.search-section .create-circle-btn[data-v-3625361c]{height:40px;padding:0 20px;background-color:#ea7034;color:#fff;border:none;border-radius:20px;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:5px;white-space:nowrap}.search-section .create-circle-btn[data-v-3625361c]:hover{background-color:#d65a2b}.search-section .create-circle-btn .icon-plus[data-v-3625361c]{font-size:16px}.circles-content .category-section[data-v-3625361c]{margin-bottom:40px}.circles-content .category-section .category-header[data-v-3625361c]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:10px;border-bottom:2px solid #ea7034}.circles-content .category-section .category-header .category-name[data-v-3625361c]{font-size:24px;font-weight:bold;color:#333;margin:0}.circles-content .category-section .category-header .circle-count[data-v-3625361c]{font-size:14px;color:#666}.circles-content .category-section .circles-grid[data-v-3625361c]{display:grid;grid-template-columns:repeat(auto-fill, minmax(300px, 1fr));gap:20px}.circle-card[data-v-3625361c]{background:#fff;border-radius:12px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.1);cursor:pointer;transition:all .3s ease}.circle-card[data-v-3625361c]:hover{transform:translateY(-2px);box-shadow:0 4px 16px rgba(0,0,0,.15)}.circle-card .circle-header[data-v-3625361c]{display:flex;align-items:flex-start;margin-bottom:15px}.circle-card .circle-header .circle-icon[data-v-3625361c]{width:60px;height:60px;border-radius:12px;object-fit:cover;margin-right:15px;flex-shrink:0}.circle-card .circle-header .circle-info[data-v-3625361c]{flex:1;min-width:0}.circle-card .circle-header .circle-info .circle-name-row[data-v-3625361c]{display:flex;align-items:center;margin-bottom:8px}.circle-card .circle-header .circle-info .circle-name-row .circle-name[data-v-3625361c]{font-size:18px;font-weight:bold;color:#333;margin:0;margin-right:10px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.circle-card .circle-header .circle-info .circle-name-row .official-tag[data-v-3625361c]{font-size:12px;color:#fff;background-color:#ea7034;padding:2px 8px;border-radius:10px;flex-shrink:0}.circle-card .circle-header .circle-info .circle-meta[data-v-3625361c]{display:flex;gap:15px}.circle-card .circle-header .circle-info .circle-meta .member-count[data-v-3625361c],.circle-card .circle-header .circle-info .circle-meta .post-count[data-v-3625361c]{font-size:14px;color:#666}.circle-card .circle-description[data-v-3625361c]{font-size:14px;color:#666;line-height:1.5;margin-bottom:15px;display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:2;overflow:hidden}.circle-card .circle-actions[data-v-3625361c]{display:flex;justify-content:flex-end}.circle-card .circle-actions .join-btn[data-v-3625361c]{padding:8px 20px;background-color:#ea7034;color:#fff;border:none;border-radius:20px;font-size:14px;cursor:pointer;transition:background-color .3s ease}.circle-card .circle-actions .join-btn[data-v-3625361c]:hover{background-color:#d65a2b}.circle-card .circle-actions .joined-btn[data-v-3625361c]{padding:8px 20px;background-color:#f0f0f0;color:#999;border:none;border-radius:20px;font-size:14px;cursor:default}.empty-state[data-v-3625361c]{text-align:center;padding:80px 20px}.empty-state .empty-icon[data-v-3625361c]{font-size:64px;margin-bottom:20px}.empty-state .empty-text[data-v-3625361c]{font-size:20px;color:#666;margin-bottom:10px}.empty-state .empty-desc[data-v-3625361c]{font-size:14px;color:#999;margin-bottom:30px}.empty-state .create-first-btn[data-v-3625361c]{padding:12px 30px;background-color:#ea7034;color:#fff;border:none;border-radius:25px;font-size:16px;cursor:pointer}.empty-state .create-first-btn[data-v-3625361c]:hover{background-color:#d65a2b}@media(max-width: 768px){.circles-container[data-v-3625361c]{padding:15px}.search-section[data-v-3625361c]{flex-direction:column;gap:15px}.search-section .search-box[data-v-3625361c]{max-width:none}.search-section .create-circle-btn[data-v-3625361c]{width:100%;justify-content:center}.circles-grid[data-v-3625361c]{grid-template-columns:1fr !important}.page-header .page-title[data-v-3625361c]{font-size:24px}}",""]),e.exports=c},629:function(e,t,r){"use strict";r.r(t);r(27),r(19);var c=r(0),n=(r(33),r(10),r(34),r(52),r(6),{name:"CirclesPage",data:function(){return{categories:[],categoryCircles:{},keyword:"",loadingStatus:"more",hasMore:!0,isLoggedIn:!1,myJoinedCircles:[]}},asyncData:function(e){return Object(c.a)(regeneratorRuntime.mark((function t(){var r,c;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$api,t.prev=1,t.next=4,r.community.getCircleCategories();case 4:return c=t.sent,t.abrupt("return",{categories:c||[]});case 8:return t.prev=8,t.t0=t.catch(1),console.error("获取圈子分类失败:",t.t0),t.abrupt("return",{categories:[]});case 12:case"end":return t.stop()}}),t,null,[[1,8]])})))()},mounted:function(){this.checkLoginStatus(),this.initializeData()},methods:{checkLoginStatus:function(){var e=localStorage.getItem("token");this.isLoggedIn=e&&JSON.parse(e).tk},initializeData:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==e.categories.length){t.next=3;break}return t.next=3,e.loadCategories();case 3:return e.categories.forEach((function(t){e.$set(e.categoryCircles,t.category_id,[])})),t.next=6,Promise.all([e.loadCirclesByCategory(),e.isLoggedIn?e.loadMyCircles():Promise.resolve()]);case 6:case"end":return t.stop()}}),t)})))()},loadCategories:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.community.getCircleCategories();case 3:r=t.sent,e.categories=r||[],t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("加载分类失败",t.t0),e.$message.error("加载分类失败");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loadCirclesByCategory:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.hasMore&&"loading"!==e.loadingStatus){t.next=2;break}return t.abrupt("return");case 2:return e.loadingStatus="loading",t.prev=3,r=e.categories.map((function(t){return e.$api.community.getCirclesList({category_id:t.category_id,keyword:e.keyword})})),t.next=7,Promise.all(r);case 7:t.sent.forEach((function(t,r){if(t&&t.list){var c=e.categories[r].category_id,n=t.list.map((function(circle){return circle.is_joined=e.myJoinedCircles.some((function(e){return e.circle_id===circle.circle_id})),circle}));e.$set(e.categoryCircles,c,n),e.categories[r].circle_count=t.total}})),e.loadingStatus="noMore",t.next=17;break;case 12:t.prev=12,t.t0=t.catch(3),console.error("加载圈子失败",t.t0),e.loadingStatus="more",e.$message.error("加载圈子失败");case 17:case"end":return t.stop()}}),t,null,[[3,12]])})))()},loadMyCircles:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.community.getMyCircles();case 3:r=t.sent,e.myJoinedCircles=r||[],Object.keys(e.categoryCircles).forEach((function(t){e.categoryCircles[t]=e.categoryCircles[t].map((function(circle){return circle.is_joined=e.myJoinedCircles.some((function(e){return e.circle_id===circle.circle_id})),circle}))})),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("加载我的圈子失败",t.t0);case 11:case"end":return t.stop()}}),t,null,[[0,8]])})))()},searchCircles:function(){this.loadCirclesByCategory()},navigateToCircle:function(e){this.$router.push("/community/circle/".concat(e))},joinCircle:function(circle){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isLoggedIn){t.next=4;break}return e.$message.warning("请先登录"),e.$router.push("/login"),t.abrupt("return");case 4:return t.prev=4,t.next=7,e.$api.community.joinCircle({circle_id:circle.circle_id});case 7:circle.is_joined=!0,circle.member_count++,e.myJoinedCircles.push(circle),e.$message.success("加入成功"),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(4),console.error("加入圈子失败",t.t0),e.$message.error(t.t0.message||"加入失败，请重试");case 17:case"end":return t.stop()}}),t,null,[[4,13]])})))()},openCreateCircle:function(){var e=this;return Object(c.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!localStorage.getItem("token")){t.next=9;break}return t.next=5,e.$api.users.generateCrossSiteToken();case 5:r=t.sent.crossSiteToken,e.$windowManager.createWindow({title:"创建圈子",url:"".concat("https://m.loghome.ink","/#/pages/users/external_login?token=").concat(r,"&redirectTo=").concat(encodeURIComponent("/pages/community/createCircle?id=".concat(e.circleId,"&hideback=true"))),width:500,height:Math.min(800,window.screen.height-200)}),t.next=10;break;case 9:e.$router.push("/login");case 10:t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("打编辑圈子窗口失败",t.t0),e.$message.error("打开编辑圈子失败，请稍后重试");case 16:case"end":return t.stop()}}),t,null,[[0,12]])})))()},handleImageError:function(e){e.target.src="/static/default-circle.png"}}}),o=n,l=(r(573),r(12)),component=Object(l.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"circles-container"},[e._m(0),e._v(" "),t("div",{staticClass:"search-section"},[t("div",{staticClass:"search-box"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.keyword,expression:"keyword"}],staticClass:"search-input",attrs:{type:"text",placeholder:"搜索圈子名称或描述"},domProps:{value:e.keyword},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchCircles.apply(null,arguments)},input:function(t){t.target.composing||(e.keyword=t.target.value)}}}),e._v(" "),t("button",{staticClass:"search-btn",on:{click:e.searchCircles}},[t("i",{staticClass:"el-icon-search"})])]),e._v(" "),t("button",{staticClass:"create-circle-btn",on:{click:e.openCreateCircle}},[t("i",{staticClass:"el-icon-plus"}),e._v("\n      创建圈子\n    ")])]),e._v(" "),t("div",{directives:[{name:"loading",rawName:"v-loading",value:"loading"===e.loadingStatus,expression:"loadingStatus === 'loading'"}],staticClass:"circles-content"},[e._l(e.categories,(function(r,c){return t("div",{key:c,staticClass:"category-section"},[t("div",{staticClass:"category-header"},[t("h2",{staticClass:"category-name"},[e._v(e._s(r.name))]),e._v(" "),t("span",{staticClass:"circle-count"},[e._v(e._s(r.circle_count)+"个圈子")])]),e._v(" "),t("div",{staticClass:"circles-grid"},e._l(e.categoryCircles[r.category_id],(function(circle,r){return t("div",{key:r,staticClass:"circle-card",on:{click:function(t){return e.navigateToCircle(circle.circle_id)}}},[t("div",{staticClass:"circle-header"},[t("img",{staticClass:"circle-icon",attrs:{src:circle.icon||"/static/default-circle.png",alt:circle.name},on:{error:e.handleImageError}}),e._v(" "),t("div",{staticClass:"circle-info"},[t("div",{staticClass:"circle-name-row"},[t("h3",{staticClass:"circle-name"},[e._v(e._s(circle.name))]),e._v(" "),circle.is_official?t("span",{staticClass:"official-tag"},[e._v("官方")]):e._e()]),e._v(" "),t("div",{staticClass:"circle-meta"},[t("span",{staticClass:"member-count"},[e._v(e._s(circle.member_count)+"人")]),e._v(" "),t("span",{staticClass:"post-count"},[e._v(e._s(circle.post_count)+"帖子")])])])]),e._v(" "),t("p",{staticClass:"circle-description"},[e._v(e._s(circle.description))])])})),0)])})),e._v(" "),0===Object.keys(e.categoryCircles).length&&"loading"!==e.loadingStatus?t("div",{staticClass:"empty-state"},[t("div",{staticClass:"empty-icon"},[e._v("📭")]),e._v(" "),t("p",{staticClass:"empty-text"},[e._v("暂无圈子")]),e._v(" "),t("p",{staticClass:"empty-desc"},[e._v("成为第一个创建圈子的人吧！")]),e._v(" "),t("button",{staticClass:"create-first-btn",on:{click:e.openCreateCircle}},[e._v("创建圈子")])]):e._e()],2)])}),[function(){var e=this,t=e._self._c;return t("div",{staticClass:"page-header"},[t("h1",{staticClass:"page-title"},[e._v("圈子广场")]),e._v(" "),t("p",{staticClass:"page-subtitle"},[e._v("发现有趣的圈子，找到志同道合的朋友")])])}],!1,null,"3625361c",null);t.default=component.exports}}]);