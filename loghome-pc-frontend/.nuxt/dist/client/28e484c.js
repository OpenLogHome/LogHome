(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{358:function(e,t,r){"use strict";var n=r(7),o=r(42),c=r(43),l=r(219),d=r(104),f=r(15),m=r(74).f,v=r(75).f,h=r(20).f,_=r(359).trim,x="Number",y=n[x],D=y,k=y.prototype,w=c(r(149)(k))==x,I="trim"in String.prototype,O=function(e){var t=d(e,!1);if("string"==typeof t&&t.length>2){var r,n,o,c=(t=I?t.trim():_(t,3)).charCodeAt(0);if(43===c||45===c){if(88===(r=t.charCodeAt(2))||120===r)return NaN}else if(48===c){switch(t.charCodeAt(1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+t}for(var code,l=t.slice(2),i=0,f=l.length;i<f;i++)if((code=l.charCodeAt(i))<48||code>o)return NaN;return parseInt(l,n)}}return+t};if(!y(" 0o1")||!y("0b1")||y("+0x1")){y=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof y&&(w?f((function(){k.valueOf.call(r)})):c(r)!=x)?l(new D(O(t)),r,y):O(t)};for(var $,N=r(13)?m(D):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;N.length>S;S++)o(D,$=N[S])&&!o(y,$)&&h(y,$,v(D,$));y.prototype=k,k.constructor=y,r(23)(n,x,y)}},359:function(e,t,r){var n=r(3),o=r(51),c=r(15),l=r(360),d="["+l+"]",f=RegExp("^"+d+d+"*"),m=RegExp(d+d+"*$"),v=function(e,t,r){var o={},d=c((function(){return!!l[e]()||"​"!="​"[e]()})),f=o[e]=d?t(h):l[e];r&&(o[r]=f),n(n.P+n.F*d,"String",o)},h=v.trim=function(e,t){return e=String(o(e)),1&t&&(e=e.replace(f,"")),2&t&&(e=e.replace(m,"")),e};e.exports=v},360:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},525:function(e,t,r){var content=r(584);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,r(26).default)("fd1c3c80",content,!0,{sourceMap:!1})},583:function(e,t,r){"use strict";r(525)},584:function(e,t,r){var n=r(25)(!1);n.push([e.i,"\n.post-edit-container[data-v-032ef9c2] {\r\n  max-width: 800px;\r\n  margin: 20px auto;\n}\n.box-card[data-v-032ef9c2] {\r\n  border-radius: 8px;\n}\r\n",""]),e.exports=n},634:function(e,t,r){"use strict";r.r(t);r(27);var n=r(9),o=r(0);r(6),r(358),r(52),r(19),r(17),r(18),r(35),r(36);function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var d={name:"PostEdit",data:function(){return{isEdit:!1,postId:null,postData:{title:"",content:"",media_urls:[],circle_id:"",novel_id:null},circles:[],myNovels:[],isSubmitting:!1,isBanned:!1,banInfo:null,uploadHeaders:{ServiceKey:"a24785bedb466b9733dd317771d4b69c08da07fd"},rules:{title:[{required:!0,message:"请输入标题",trigger:"blur"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],circle_id:[{required:!0,message:"请选择圈子",trigger:"change"}]}}},mounted:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.checkLoginStatus(),!e.$route.query.post_id){t.next=8;break}return e.isEdit=!0,e.postId=e.$route.query.post_id,t.next=6,e.loadPostDetail();case 6:t.next=9;break;case 8:e.$route.query.circle_id&&(e.postData.circle_id=Number(e.$route.query.circle_id),e.checkCircleBanStatus(e.postData.circle_id));case 9:return t.next=11,e.loadCircles();case 11:return t.next=13,e.loadMyNovels();case 13:case"end":return t.stop()}}),t)})))()},methods:{checkLoginStatus:function(){localStorage.getItem("token")||(this.$message.warning("请先登录"),this.$router.push("/login"))},loadCircles:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.community.getMyCircles();case 3:r=t.sent,e.circles=r,e.postData.circle_id&&(e.circles.some((function(t){return t.circle_id===e.postData.circle_id}))||(e.postData.circle_id="")),t.next=12;break;case 8:t.prev=8,t.t0=t.catch(0),console.error("加载圈子失败",t.t0),e.$message.error("加载圈子失败");case 12:case"end":return t.stop()}}),t,null,[[0,8]])})))()},loadMyNovels:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.essays.getNovelsOf();case 3:r=t.sent,e.myNovels=r,t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("加载作品失败",t.t0),e.$message.error("加载作品失败");case 11:case"end":return t.stop()}}),t,null,[[0,7]])})))()},loadPostDetail:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,e.$api.community.getPostDetail({post_id:e.postId});case 3:r=t.sent,e.postData.title=r.title,e.postData.content=r.content,e.postData.media_urls=r.media_urls?r.media_urls.map((function(e){return{url:e}})):[],e.postData.circle_id=r.circle_id,e.postData.novel_id=r.novel_id||null,t.next=15;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("加载帖子详情失败",t.t0),e.$message.error("加载帖子详情失败");case 15:case"end":return t.stop()}}),t,null,[[0,11]])})))()},handleImageSuccess:function(e,t,r){if(e.data&&e.data.resource_id){var n="https://storage.codesocean.top/api/resource/get/"+e.data.resource_id;this.postData.media_urls.push({url:n})}else this.$message.error("图片上传失败"),r.pop()},handleImageRemove:function(e,t){this.postData.media_urls=t},beforeImageUpload:function(e){var t=e.size/1024/1024<2;return t||this.$message.error("上传图片大小不能超过 2MB!"),t},handleCircleChange:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.checkCircleBanStatus(e);case 2:case"end":return r.stop()}}),r)})))()},checkCircleBanStatus:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,t.$api.community.getCircleMyStatus({circle_id:e});case 3:(n=r.sent)&&(t.isBanned=n.is_banned,t.banInfo=n.ban_info,t.isBanned&&(o=t.banInfo.end_time?"，将于 ".concat(new Date(t.banInfo.end_time).toLocaleString()," 解除"):"，永久禁言",t.$alert("您在该圈子中已被禁言".concat(o,"，无法发布帖子"),"禁言提示",{confirmButtonText:"确定",callback:function(){t.postData.circle_id=""}}))),r.next=10;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("获取禁言状态失败",r.t0);case 10:case"end":return r.stop()}}),r,null,[[0,7]])})))()},submitPost:function(){var e=this;this.$refs.postForm.validate(function(){var t=Object(o.a)(regeneratorRuntime.mark((function t(r){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!r){t.next=27;break}if(!e.isBanned){t.next=4;break}return e.$message.warning("您已被禁言，无法发布帖子"),t.abrupt("return");case 4:if(e.isSubmitting=!0,t.prev=5,n={title:e.postData.title.trim(),content:e.postData.content.trim(),media_urls:e.postData.media_urls.map((function(e){return e.url})),novel_id:e.postData.novel_id},!e.isEdit){t.next=12;break}return t.next=10,e.$api.community.updatePost(l({post_id:e.postId},n));case 10:t.next=16;break;case 12:return n.circle_id=e.postData.circle_id,n.type=0,t.next=16,e.$api.community.createPost(n);case 16:e.$message.success(e.isEdit?"编辑成功":"发布成功，等待审核"),e.$router.push("/community"),t.next=24;break;case 20:t.prev=20,t.t0=t.catch(5),console.error("提交失败",t.t0),e.$message.error(e.isEdit?"编辑失败，请重试":"发布失败，请重试");case 24:return t.prev=24,e.isSubmitting=!1,t.finish(24);case 27:case"end":return t.stop()}}),t,null,[[5,20,24,27]])})));return function(e){return t.apply(this,arguments)}}())},cancel:function(){this.$router.back()}}},f=d,m=(r(583),r(12)),component=Object(m.a)(f,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"post-edit-container"},[t("el-card",{staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(e.isEdit?"编辑帖子":"发布新帖"))])]),e._v(" "),t("el-form",{ref:"postForm",attrs:{model:e.postData,rules:e.rules,"label-width":"100px"}},[t("el-form-item",{attrs:{label:"标题",prop:"title"}},[t("el-input",{attrs:{placeholder:"请输入标题",maxlength:"50","show-word-limit":""},model:{value:e.postData.title,callback:function(t){e.$set(e.postData,"title",t)},expression:"postData.title"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"内容",prop:"content"}},[t("el-input",{attrs:{type:"textarea",rows:6,placeholder:"分享你的想法...",maxlength:"2000","show-word-limit":""},model:{value:e.postData.content,callback:function(t){e.$set(e.postData,"content",t)},expression:"postData.content"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"图片"}},[t("el-upload",{attrs:{action:"https://storage.codesocean.top/api/resource/upload?container=172018735018984","list-type":"picture-card","file-list":e.postData.media_urls,"on-success":e.handleImageSuccess,"on-remove":e.handleImageRemove,"before-upload":e.beforeImageUpload,headers:e.uploadHeaders,multiple:"",limit:9}},[t("i",{staticClass:"el-icon-plus"})])],1),e._v(" "),t("el-form-item",{attrs:{label:"发布到",prop:"circle_id"}},[t("el-select",{attrs:{placeholder:"请选择圈子"},on:{change:e.handleCircleChange},model:{value:e.postData.circle_id,callback:function(t){e.$set(e.postData,"circle_id",t)},expression:"postData.circle_id"}},e._l(e.circles,(function(circle){return t("el-option",{key:circle.circle_id,attrs:{label:circle.name,value:circle.circle_id}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"绑定作品"}},[t("el-select",{attrs:{placeholder:"请选择作品（可选）",clearable:""},model:{value:e.postData.novel_id,callback:function(t){e.$set(e.postData,"novel_id",t)},expression:"postData.novel_id"}},e._l(e.myNovels,(function(e){return t("el-option",{key:e.novel_id,attrs:{label:e.name,value:e.novel_id}})})),1)],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary",loading:e.isSubmitting},on:{click:e.submitPost}},[e._v(e._s(e.isEdit?"保存":"发布"))]),e._v(" "),t("el-button",{on:{click:e.cancel}},[e._v("取消")])],1)],1)],1)],1)}),[],!1,null,"032ef9c2",null);t.default=component.exports}}]);