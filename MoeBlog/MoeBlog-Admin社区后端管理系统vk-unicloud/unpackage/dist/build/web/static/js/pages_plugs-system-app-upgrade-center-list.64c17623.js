(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages_plugs-system-app-upgrade-center-list"],{"011d":function(e,t,a){"use strict";a("6a54"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=uni.vk,i={},o={appid:"",name:"",title:"",contents:"",platform:[],platformRadio:"",type:"",version:"",min_uni_version:"",url:"",stable_publish:!1,is_silently:!1,is_mandatory:!1,create_env:"upgrade-center",store_list:[]},l={props:{value:{Type:Object,default:function(){return{show:!1,mode:"",item:{stable_publish:""},options:{}}}}},data:function(){var e=this;return{page:{title:"标题",submitText:"确定",cancelText:"关闭",showCancel:!0,top:"2vh",width:"900px"},form1:{data:o,props:{action:"",columns:[{key:"appid",title:"AppID",type:"text",disabled:!0},{key:"name",title:"应用名称",type:"text",disabled:!0},{key:"title",title:"更新标题",type:"text"},{key:"contents",title:"更新内容",type:"textarea",autosize:{minRows:4,maxRows:10},maxlength:2e3,showWordLimit:!0},{key:"platformRadio",title:"平台",type:"radio",itemWidth:80,data:[{value:"Android",label:"安卓"},{value:"iOS",label:"苹果"}],showRule:"type==native_app",disabled:["update"]},{key:"platform",title:"平台",type:"checkbox",itemWidth:80,data:[{value:"Android",label:"安卓"},{value:"iOS",label:"苹果"}],showRule:"type==wgt",disabled:["update"]},{key:"version",title:"版本号",type:"text",tips:"必须大于当前线上发行的版本号",disabled:["update"]},{key:"min_uni_version",title:"原生App最低版本",type:"text",showRule:"type==wgt"},{key:"url",title:"AppStore",type:"text",showRule:function(e){return"iOS"===e.platformRadio&&"native_app"===e.type}},{key:"apk",title:"上传apk包",type:"file",limit:1,accept:".apk",showRule:function(e){return"Android"===e.platformRadio&&"native_app"===e.type},watch:function(e){var t=e.value,a=(e.formData,e.column,e.index,e.$set);a("url",t)},tips:'上传apk包，上传成功后，会自动使用云存储地址填充下载链接，支持<a href="https://vkdoc.fsq.pub/client/pages/uploadFile.html#%E9%BB%98%E8%AE%A4%E4%B8%8A%E4%BC%A0%E8%87%B3%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8" target="_blank">扩展存储</a>'},{key:"wgt",title:"上传wgt包",type:"file",limit:1,accept:".wgt",showRule:function(e){return"wgt"===e.type},watch:function(e){var t=e.value,a=(e.formData,e.column,e.index,e.$set);a("url",t)},tips:'上传wgt包，上传成功后，会自动使用云存储地址填充下载链接，支持<a href="https://vkdoc.fsq.pub/client/pages/uploadFile.html#%E9%BB%98%E8%AE%A4%E4%B8%8A%E4%BC%A0%E8%87%B3%E6%89%A9%E5%B1%95%E5%AD%98%E5%82%A8" target="_blank">扩展存储</a>'},{key:"url",title:"下载链接",type:"text",showRule:function(e){return"Android"===e.platformRadio||"wgt"===e.type}},{key:"store_list",title:"Android应用市场",type:"array<object>",showRule:function(e){return!!("Android"===e.platformRadio&&"native_app"===e.type&&e.store_list&&e.store_list.length>0)},rowKey:"id",showAdd:!1,showClear:!1,showSort:!0,defaultValue:{},rightBtns:["delete"],columns:[{key:"enable",title:"是否启用",type:"switch",width:80},{key:"name",title:"商店名称",type:"text",minWidth:180,disabled:!0},{key:"scheme",title:"Scheme",type:"text",minWidth:280,disabled:!0}]},{key:"is_silently",title:"静默更新",type:"switch",activeValue:!0,inactiveValue:!1,showRule:"type==wgt"},{key:"is_mandatory",title:"强制更新",type:"switch",activeValue:!0,inactiveValue:!1},{key:"stable_publish",title:"上线发行",type:"switch",activeValue:!0,inactiveValue:!1,disabled:function(t){return e.value.item.stable_publish&&"update"===e.value.mode}}],rules:{appid:[{required:!0,message:"appid不能为空",trigger:["blur","change"]}],contents:[{required:!0,message:"更新内容不能为空",trigger:["blur","change"]}],platform:[{required:!0,message:"平台不能为空",trigger:["blur","change"]}],platformRadio:[{required:!0,message:"平台不能为空",trigger:["blur","change"]}],version:[{required:!0,message:"版本号不能为空",trigger:["blur","change"]},{validator:n.pubfn.validator("version"),message:"版本号格式必须为：xx.xx.xx（3个数字组成，数字范围1-99,0-99,0-99） 如1.0.1 不可以是1.0.01",trigger:"blur"}],min_uni_version:[{required:!0,message:"最低版本号不能为空",trigger:["blur","change"]},{validator:n.pubfn.validator("version"),message:"版本号格式必须为：xx.xx.xx（3个数字组成，数字范围1-99,0-99,0-99） 如1.0.1 不可以是1.0.01",trigger:"blur"}],url:[{required:!0,message:"链接不能为空",trigger:["blur","change"]}]},formType:"",labelWidth:"140px"}}}},mounted:function(){this.init()},methods:{init:function(){var e=this.value;this.$emit("input",e),i["form1"]=n.pubfn.copyObject(this.form1)},onOpen:function(){var e=this.value,t=void 0===e?{}:e,a=t.item,i=void 0===a?{}:a,l="native_app"===i.type?"原生APP安装包":"wgt资源包";"update"===t.mode?(this.form1.props.action="admin/system/app-upgrade-center/sys/addUpdate",this.page.title=""+"修改 - ".concat(l),this.page.submitText="修改","native_app"===i.type&&(i.platformRadio=i.platform[0]),this.form1.data=n.pubfn.objectAssign(n.pubfn.copyObject(o),n.pubfn.copyObject(i))):(this.form1.props.action="admin/system/app-upgrade-center/sys/addUpdate",this.page.title=""+"添加 - ".concat(l),this.page.submitText="添加",this.form1.data=n.pubfn.objectAssign(n.pubfn.copyObject(o),n.pubfn.copyObject(i)))},onClose:function(){this.resetForm()},onFormSuccess:function(){this.value.show=!1,this.$emit("success")},resetForm:function(){n.pubfn.resetForm(i,this)},toUrl:function(e){window.open(e)}},watch:{},computed:{}};t.default=l},"0d05":function(e,t,a){"use strict";a.r(t);var n=a("7af2"),i=a("dfe8");for(var o in i)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(o);var l=a("828b"),r=Object(l["a"])(i["default"],n["b"],n["c"],!1,null,"369423b4",null,!1,n["a"],void 0);t["default"]=r.exports},"419c":function(e,t,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("fd3c"),a("5c47"),a("af8f");var i,o=n(a("0d05")),l=uni.vk,r={},s={components:{addUpdate:o.default},data:function(){var e=this;return{appList:[],loading:!1,data:{},table1:{action:"admin/system/app-upgrade-center/sys/getList",columns:[{key:"appid",title:"AppID",type:"text",width:140},{key:"title",title:"更新标题",type:"text",width:120},{key:"type",title:"安装包类型",type:"tag",width:140,size:"small",data:[{value:"native_app",label:"原生App安装包",tagType:"primary",effect:"light"},{value:"wgt",label:"Wgt资源包",tagType:"success",effect:"light"}]},{key:"platform",title:"平台",type:"checkbox",width:100,align:"left",itemWidth:80,data:[{value:"Android",label:"安卓"},{value:"iOS",label:"苹果"}]},{key:"store_list",title:"已上架应用市场",type:"text",width:120,align:"left",formatter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t="";return e.map((function(a,n){t+=a.name,n!==e.length-1&&(t+="、")})),t||(t="-"),t}},{key:"version",title:"版本号",type:"text",width:100},{key:"stable_publish",title:"安装包状态",type:"tag",width:120,size:"small",data:[{value:!0,label:"已上线",tagType:"success",effect:"light"},{value:!1,label:"已下线",tagType:"info",effect:"light"}]},{key:"create_date",title:"上传时间",type:"time",width:160,sortable:"custom"},{key:"create_date",title:"距离现在",type:"dateDiff",width:120}],multipleSelection:[],selectItem:""},queryForm1:{formData:{appid:""},columns:[{key:"appid",title:"所属应用",type:"select",placeholder:"请选择应用",width:140,mode:"=",props:{value:"appid",label:"name"},data:function(){return e.appList}},{key:"title",title:"标题",type:"text",width:140,mode:"%%"},{key:"type",title:"安装包类型",type:"select",width:140,placeholder:"请选择类型",data:[{value:"native_app",label:"原生App安装包"},{value:"wgt",label:"Wgt资源包"}]},{key:"stable_publish",title:"安装包状态",type:"select",width:140,placeholder:"请选择状态",data:[{value:!0,label:"已上线"},{value:!1,label:"已下线"}]},{key:"create_date",title:"上传时间",type:"datetimerange",width:360,mode:"[]"}]},formDatas:{}}},onLoad:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i=this,l=i.vk,i.options=e,i.init(e)},onReady:function(){},onShow:function(){},onHide:function(){},methods:{init:function(e){r["form1"]=l.pubfn.copyObject(i.form1),l.callFunction({url:"admin/system/app/sys/getList",loading:!0,data:{formData:{enable_upgrade_center:!0},columns:[{key:"enable_upgrade_center",type:"select",mode:"="}]},success:function(t){i.appList=t.rows,e.appid?(i.queryForm1.formData.appid=e.appid,i.search()):t.rows.length>0&&(i.queryForm1.formData.appid=t.rows[0].appid,i.search())}})},pageTo:function(e){l.navigateTo(e)},resetForm:function(){l.pubfn.resetForm(r,i)},search:function(){i.$refs.table1.search()},refresh:function(){i.$refs.table1.refresh()},getCurrentRow:function(){return i.$refs.table1.getCurrentRow()},currentChange:function(e){i.table1.selectItem=e},selectionChange:function(e){i.table1.multipleSelection=e},addBtn:function(e){var t=i.queryForm1.formData.appid,a=l.pubfn.getListItem(i.appList,"appid",t),n={appid:t,type:e,name:a.name,store_list:a.store_list};l.pubfn.openForm("addUpdate",{mode:"add",item:n})},updateBtn:function(e){var t=e.item;l.pubfn.openForm("addUpdate",{mode:"update",item:t})},deleteBtn:function(e){var t=e.item,a=e.deleteFn;if(t.stable_publish)return this.$message({showClose:!0,message:"不可删除已上线的版本",type:"error"}),!1;a({action:"admin/system/app-upgrade-center/sys/delete",data:{_id:t._id}})},batchBtn:function(e){switch(e){case 1:l.toast("批量操作按钮1");break;case 2:l.toast("批量操作按钮2");break;default:break}}},watch:{},computed:{}};t.default=s},"626a":function(e,t,a){"use strict";a.r(t);var n=a("d19f"),i=a("e224");for(var o in i)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return i[e]}))}(o);a("ffb9");var l=a("828b"),r=Object(l["a"])(i["default"],n["b"],n["c"],!1,null,"0d10b65b",null,!1,n["a"],void 0);t["default"]=r.exports},"7af2":function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("vk-data-dialog",{attrs:{title:e.page.title,top:e.page.top,width:e.page.width,"close-on-click-modal":!0,"destroy-on-close":!0,mode:"form"},on:{open:function(t){arguments[0]=t=e.$handleEvent(t),e.onOpen.apply(void 0,arguments)},closed:function(t){arguments[0]=t=e.$handleEvent(t),e.onClose.apply(void 0,arguments)}},model:{value:e.value.show,callback:function(t){e.$set(e.value,"show",t)},expression:"value.show"}},[a("vk-data-form",{ref:"form1",attrs:{"form-type":e.value.mode,rules:e.form1.props.rules,action:e.form1.props.action,columns:e.form1.props.columns,loading:e.form1.props.loading,labelWidth:e.form1.props.labelWidth,"show-cancel":e.page.showCancel,"cancel-text":e.page.cancelText,"submit-text":e.page.submitText},on:{"update:loading":function(t){arguments[0]=t=e.$handleEvent(t),e.$set(e.form1.props,"loading",t)},success:function(t){arguments[0]=t=e.$handleEvent(t),e.onFormSuccess.apply(void 0,arguments)}},scopedSlots:e._u([{key:"url",fn:function(t){var n=t.form,i=t.keyName;return[a("v-uni-view",[a("el-input",{scopedSlots:e._u([n[i]?{key:"append",fn:function(){return[a("el-button",{on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.toUrl(n[i])}}},[e._v("测试下载")])]},proxy:!0}:null],null,!0),model:{value:n[i],callback:function(t){e.$set(n,i,t)},expression:"form[keyName]"}})],1)]}}]),model:{value:e.form1.data,callback:function(t){e.$set(e.form1,"data",t)},expression:"form1.data"}})],1)},i=[]},b836:function(e,t,a){var n=a("c86c");t=n(!1),t.push([e.i,"",""]),e.exports=t},c2d9:function(e,t,a){var n=a("b836");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=a("967d").default;i("57bc7c91",n,!0,{sourceMap:!1,shadowMode:!1})},d19f:function(e,t,a){"use strict";a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-uni-view",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"page-body"},[a("vk-data-table-query",{attrs:{columns:e.queryForm1.columns,"main-columns":["appid","title","type","stable_publish"]},on:{search:function(t){arguments[0]=t=e.$handleEvent(t),e.search.apply(void 0,arguments)}},model:{value:e.queryForm1.formData,callback:function(t){e.$set(e.queryForm1,"formData",t)},expression:"queryForm1.formData"}}),a("v-uni-view",[a("el-row",[a("el-dropdown",{attrs:{placement:"bottom-start"},on:{command:function(t){arguments[0]=t=e.$handleEvent(t),e.addBtn.apply(void 0,arguments)}}},[a("el-button",{attrs:{type:"success",size:"small",icon:"el-icon-circle-plus-outline",disabled:!e.queryForm1.formData.appid}},[e._v("添加")]),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{command:"native_app"}},[e._v("原生App安装包")]),a("el-dropdown-item",{attrs:{command:"wgt"}},[e._v("wgt资源包")])],1)],1)],1)],1),a("vk-data-table",{ref:"table1",attrs:{action:e.table1.action,columns:e.table1.columns,"query-form-param":e.queryForm1,"right-btns":["detail_auto","update","delete"],selection:!1,"row-no":!0,pagination:!0,"auto-action":!1},on:{update:function(t){arguments[0]=t=e.$handleEvent(t),e.updateBtn.apply(void 0,arguments)},delete:function(t){arguments[0]=t=e.$handleEvent(t),e.deleteBtn.apply(void 0,arguments)},"current-change":function(t){arguments[0]=t=e.$handleEvent(t),e.currentChange.apply(void 0,arguments)},"selection-change":function(t){arguments[0]=t=e.$handleEvent(t),e.selectionChange.apply(void 0,arguments)}}}),a("addUpdate",{on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.refresh.apply(void 0,arguments)}},model:{value:e.formDatas.addUpdate,callback:function(t){e.$set(e.formDatas,"addUpdate",t)},expression:"formDatas.addUpdate"}})],1)},i=[]},dfe8:function(e,t,a){"use strict";a.r(t);var n=a("011d"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},e224:function(e,t,a){"use strict";a.r(t);var n=a("419c"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(e){a.d(t,e,(function(){return n[e]}))}(o);t["default"]=i.a},ffb9:function(e,t,a){"use strict";var n=a("c2d9"),i=a.n(n);i.a}}]);