import{h as e,B as t,k as a,o as s,p as i,b as l,w as o,l as r,u as c,d as m,t as u,a as n,L as d,F as f,q as _,m as v,x as g,e as p,i as x,R as h}from"./index-BcbBmaH1.js";import{_ as k}from"./u-icon.C0MRo5fe.js";import{r as I}from"./uni-app.es.CDgP4_Nc.js";import{_ as y}from"./u-action-sheet.ukLITz2J.js";import{_ as b}from"./square.DS5UtVkO.js";import{_ as j,a as C,b as F}from"./like.DUCAGHvM.js";import{a as V,u as S,g as q}from"./utils.qqFolnPJ.js";import{J as A,K as T}from"./api.D6LgEBnm.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=L({__name:"art-item",props:["item"],emits:["refresh"],setup(L,{emit:$}){const R=$,w=e(!1),z=L,U=e(!1),B=e(0),D=e(null),E=e([{text:"编辑文章",disabled:z.item.user_id!=vk.getVuex("$user.userInfo")._id},{text:"删除文章",disabled:z.item.user_id!=vk.getVuex("$user.userInfo")._id,color:"#F44336"}]),G=e(!1);if(G.value=t.getCurrentUserInfo().role.indexOf("admin")>-1,G.value){let e=[{text:"审核通过",disabled:0==z.item.Audit},{text:"退回审核",disabled:2==z.item.Audit}];E.value.push(...e)}if(D.value=z.item.coverImg,z.item.coverImg.length>3){let e=z.item.coverImg.length;B.value=e,z.item.coverImg=z.item.coverImg.slice(0,3)}function H(){U.value=!0}function J(){w.value=!0}function K(e){if(console.log(e),0==e&&vk.navigateTo("/pages/art/addArt?id="+z.item._id),1==e&&vk.confirm("确定删除文章?",(e=>{if(e.confirm){let e={user_id:vk.getVuex("$user.userInfo")._id,_id:z.item._id};A(e).then((e=>{let t=g();vk.redirectTo(t[0].$page.fullPath)}))}})),2==e){console.log("审核通过");let e={_id:z.item._id,Audit:0,taxonmoy_id:z.item.taxonmoy_id};T(e).then((e=>{R("refresh",!0),console.log(e)}))}if(3==e){let e={_id:z.item._id,Audit:2,taxonmoy_id:z.item.taxonmoy_id};T(e).then((e=>{R("refresh",!0),console.log(e)}))}}return(e,t)=>{const g=p,A=x,T=I(a("u-icon"),k),L=h,$=I(a("u-action-sheet"),y);return s(),i(f,null,[l(A,{class:"art-item",onClick:t[2]||(t[2]=e=>{return t=z.item._id,void vk.navigateTo("/pages/art/art?id="+t);var t})},{default:o((()=>[l(A,{class:"art-ctx"},{default:o((()=>[l(A,{class:"art-head"},{default:o((()=>[l(A,{class:"art-head-R"},{default:o((()=>[l(g,{onClick:t[0]||(t[0]=r((e=>{return t=z.item.userInfo._id,void vk.navigateTo("/pages/userinfo/userinfo?id="+t);var t}),["stop"])),mode:"aspectFill",src:c(V)(z.item.userInfo)},null,8,["src"]),l(A,{class:"user"},{default:o((()=>[l(A,{class:"name"},{default:o((()=>[m(u(c(S)(z.item.userInfo)),1)])),_:1}),l(A,{class:"gxqm"},{default:o((()=>[m(u(c(q)(z.item.userInfo)),1)])),_:1})])),_:1})])),_:1}),l(A,{class:"art-head-L"},{default:o((()=>[l(A,{class:"art-head-L-c",onClick:r(H,["stop"])},{default:o((()=>[l(A,{class:"iconS"}),l(A,{class:"iconS"}),l(A,{class:"iconS"})])),_:1})])),_:1})])),_:1}),l(A,{class:"art-center"},{default:o((()=>[l(A,{class:"art-title"},{default:o((()=>[m(u(z.item.title),1)])),_:1}),l(A,{class:"art-desc"},{default:o((()=>[m(u(z.item.content),1)])),_:1}),0==z.item.coverVideo.length?(s(),n(A,{key:0,class:d(["art-C-img",1==z.item.coverImg.length?"imgStyle1":2==z.item.coverImg.length?"imgStyle2":"imgStyle3"])},{default:o((()=>[(s(!0),i(f,null,_(z.item.coverImg,((e,t)=>(s(),n(g,{mode:"aspectFill",src:e},null,8,["src"])))),256)),B.value>3?(s(),n(A,{key:0,class:"imgicon"},{default:o((()=>[l(T,{name:"photo"}),m(" "+u(B.value),1)])),_:1})):v("",!0)])),_:1},8,["class"])):(s(),n(A,{key:1,class:"art-C-tv"},{default:o((()=>[l(L,{onClick:r(J,["stop"]),autoplay:!1,"object-fit":"cover",src:z.item.coverVideo},null,8,["src"])])),_:1}))])),_:1}),l(A,{class:"art-bottom"},{default:o((()=>[z.item.taxonomy?(s(),n(A,{key:0,class:"category",onClick:t[1]||(t[1]=r((e=>{return t=z.item.taxonmoy_id,void vk.navigateTo("/pages/square/squareInfo?id="+t);var t}),["stop"]))},{default:o((()=>[l(A,{class:"category-icon"},{default:o((()=>[l(g,{mode:"aspectFill",src:b})])),_:1}),l(A,{class:"category-name"},{default:o((()=>[m(u(z.item.taxonomy.name),1)])),_:1})])),_:1})):v("",!0),l(A,{class:"art-info"},{default:o((()=>[l(A,{class:"art-info-C"},{default:o((()=>[l(A,{class:"art-info-R"},{default:o((()=>[m(u(z.item._add_time_str.slice(0,10)),1)])),_:1}),l(A,{class:"art-info-L"},{default:o((()=>[l(A,{class:"art-info-I"},{default:o((()=>[l(g,{mode:"aspectFill",src:j}),m(" "+u(z.item.view_count),1)])),_:1}),l(A,{class:"art-info-I"},{default:o((()=>[l(g,{mode:"aspectFill",src:C}),m(" "+u(z.item.comment_count),1)])),_:1}),l(A,{class:"art-info-I"},{default:o((()=>[l(g,{mode:"aspectFill",src:F}),m(" "+u(z.item.like_count),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),l($,{onClick:K,"safe-area-inset-bottom":!0,"z-index":"9999","border-radius":"25",list:E.value,modelValue:U.value,"onUpdate:modelValue":t[3]||(t[3]=e=>U.value=e)},null,8,["list","modelValue"])],64)}}},[["__scopeId","data-v-d90785ee"]]);export{$ as _};
