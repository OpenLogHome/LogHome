import{p as e,d as t,o as a,a as s,w as l,b as o,u as n,k as u,t as i,s as m,f as r,l as c,i as d,m as p,h as _,F as f,U as v,O as g}from"./index-C69BgsYY.js";import{_ as h}from"./uni-icons.DbPdresR.js";import{r as k}from"./uni-app.es.4Bntlf4B.js";import{a as I,u as C,g as x}from"./utils.qqFolnPJ.js";import{q as y,r as V,s as b,t as j}from"./api.ClmPzCnk.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as z}from"./u-button.CQyuZRx3.js";import{_ as w}from"./u-popup.CZC_HG1o.js";import{g as R}from"./check.CqE10ALw.js";const q=$({__name:"comment-list-item",props:["item"],emits:["delComment"],setup(_,{emit:f}){const v=_,g=f,V=e(vk.getVuex("$user.userInfo")._id);return(e,_)=>{const f=c,b=d,j=p,$=k(t("uni-icons"),h);return a(),s(b,{class:"comments-list"},{default:l((()=>[o(b,{class:"comments-C"},{default:l((()=>[o(b,{class:"comments-C-I"},{default:l((()=>[o(b,{class:"comments-C-I-L"},{default:l((()=>[o(f,{mode:"aspectFill",src:n(I)(v.item.userinfo)},null,8,["src"])])),_:1}),o(b,{class:"comments-C-I-C"},{default:l((()=>[o(b,{class:"name"},{default:l((()=>[u(i(n(C)(v.item.userinfo)),1)])),_:1}),o(b,{class:"gxqm"},{default:l((()=>[u(i(n(x)(v.item.userinfo)),1)])),_:1}),o(b,{class:"content"},{default:l((()=>[u(i(v.item.content),1)])),_:1}),o(b,{class:"timer"},{default:l((()=>[o(b,{class:"time"},{default:l((()=>[u(i(v.item._add_time_str.slice(0,10)),1)])),_:1}),o(b,{class:"text"},{default:l((()=>[u("回复")])),_:1})])),_:1}),"children"in v.item&&0!=v.item.children.length?(a(),s(b,{key:0,class:"more",onClick:_[0]||(_[0]=m((e=>function(e){e.username=v.item.content;let t=JSON.stringify(e);vk.navigateTo("/pages/comments_detail/comments_detail?item="+t)}({comments_id:v.item._id,art_id:v.item.art_id})),["stop"]))},{default:l((()=>[o(j,null,{default:l((()=>[u("共"+i(v.item.children.length)+"条评论",1)])),_:1}),o($,{type:"right",size:"18"})])),_:1})):r("",!0),o(b,{class:"hr"})])),_:1}),V.value==v.item.user_id?(a(),s(b,{key:0,class:"comments-C-I-R",onClick:_[1]||(_[1]=m((e=>(v.item._id,void vk.confirm("是否删除此评论",(e=>{if(e.confirm){let e={_id:v.item._id,art_id:v.item.art_id};""!=v.item.parent_id&&(e.parent_id=v.item.parent_id),y(e).then((e=>{g("delComment",v.item._id),console.log(e)}))}})))),["stop"]))},{default:l((()=>[u(" 删除 ")])),_:1})):r("",!0)])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-03df0ed5"]]),F=$({__name:"comments-send-item",props:["artInfo"],emits:["popColse","commentSc"],setup(n,{expose:r,emit:c}){const y=n,$=e(!1),q=e("善语结善缘，恶语伤人心"),F=c,H=e(!1);0!=y.artInfo.like_info.length&&(H.value=!0),console.log(y.artInfo),console.log(H.value);const N=e({content:"",art_id:y.artInfo.artid,level:y.artInfo.level,parent_id:y.artInfo.parent_id});function S(){var e;vk.checkToken()?0!=N.value.art_id.length&&0!=N.value.content.length&&N.value.level<2?(N.value.content,null==(e=vk.getVuex("$user.userInfo").wx_openid)||e["mp-weixin"],R().then((e=>{e.isT?V(N.value).then((e=>{let t={_id:e.result,content:N.value.content,userinfo:{username:C(vk.getVuex("$user.userInfo")),avatar:I(vk.getVuex("$user.userInfo")),_id:vk.getVuex("$user.userInfo")._id,gxqm:x(vk.getVuex("$user.userInfo"))},_add_time_str:"刚刚",parent_id:N.value.parent_id};F("commentSc",t),N.value.content="",U()})):vk.toast(e.msg)}))):vk.toast("请输入评论内容"):vk.toast("请登录后再评论")}async function T(){N.value.art_id=y.artInfo.artid,N.value.level=y.artInfo.level,N.value.parent_id=y.artInfo.parent_id,await v((()=>{q.value=`回复@ ${y.artInfo.username}`,0===y.artInfo.username.length&&(q.value="善语结善缘 恶语伤人心"),$.value=!0}))}function U(){$.value=!1,F("popColse")}function L(){H.value=!H.value,vk.pubfn.debounce((()=>{let e={art_id:N.value.art_id};H.value?j(e).then((e=>{F("popColse",!0),console.log(e)})):b(e).then((e=>{F("popColse",!1),console.log(e)}))}),3e3,!0)}return r({openPop:T}),(e,n)=>{const r=p,c=d,v=k(t("uni-icons"),h),I=g,C=k(t("u-button"),z),x=k(t("u-popup"),w);return a(),_(f,null,[o(c,{class:"comments-item",onClick:T},{default:l((()=>[o(c,{class:"comments-L"},{default:l((()=>[o(r,null,{default:l((()=>[u("善语结善缘，恶语伤人心")])),_:1})])),_:1}),o(c,{class:"comments-R"},{default:l((()=>[o(c,{class:"comments-R-I"},{default:l((()=>[o(v,{type:"chat",size:"30"}),o(r,null,{default:l((()=>[u(i(y.artInfo.commentsN),1)])),_:1})])),_:1}),o(c,{class:"comments-R-I",onClick:m(L,["stop"])},{default:l((()=>[H.value?(a(),s(v,{key:0,type:"heart-filled",color:"red",size:"30"})):(a(),s(v,{key:1,type:"heart",size:"30"}))])),_:1})])),_:1})])),_:1}),o(c,{class:"popup"},{default:l((()=>[o(x,{onClose:U,closeable:"",mode:"bottom",modelValue:$.value,"onUpdate:modelValue":n[1]||(n[1]=e=>$.value=e),class:"upopup","border-radius":"15","close-icon-pos":"top-left"},{default:l((()=>[o(c,{class:"popup-C"},{default:l((()=>[o(c,{class:"popup-H"},{default:l((()=>[o(c,{class:"H-title"},{default:l((()=>[u("回复帖子")])),_:1})])),_:1}),o(c,{class:"send-C"},{default:l((()=>[o(c,{class:"ipt"},{default:l((()=>[o(I,{modelValue:N.value.content,"onUpdate:modelValue":n[0]||(n[0]=e=>N.value.content=e),"auto-height":!0,placeholder:q.value},null,8,["modelValue","placeholder"])])),_:1}),o(c,{class:"btn"},{default:l((()=>[o(C,{onClick:S,type:"primary"},{default:l((()=>[u("发送")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["modelValue"])])),_:1})],64)}}},[["__scopeId","data-v-d64fc8d8"]]);export{q as _,F as a};
