import{k as e,o as l,a as t,w as a,b as s,l as u,n as o,d as i,t as n,p as c,F as d,q as r,m,i as f,W as h,X as p,h as _,C as v,e as y,f as b,I as g,O as k}from"./index-BcbBmaH1.js";import{_ as x}from"./uni-icons.DNeyR9zY.js";import{r as C,o as S}from"./uni-app.es.CDgP4_Nc.js";import{_ as V}from"./u-button.D0fXPeiT.js";import{_ as N}from"./u-popup.Blx2ASJN.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{z as U,A as T}from"./api.D6LgEBnm.js";import"./u-icon.C0MRo5fe.js";const A=I({emits:["update:modelValue","input","confirm"],props:{value:{type:Boolean,default:!1},modelValue:{type:Boolean,default:!1},list:{type:Array,default:()=>[]},border:{type:Boolean,default:!0},cancelColor:{type:String,default:"#606266"},confirmColor:{type:String,default:"#2979ff"},zIndex:{type:[String,Number],default:0},safeAreaInsetBottom:{type:Boolean,default:!1},maskCloseAble:{type:Boolean,default:!0},defaultValue:{type:Array,default:()=>[0]},mode:{type:String,default:"single-column"},valueName:{type:String,default:"value"},labelName:{type:String,default:"label"},childName:{type:String,default:"children"},title:{type:String,default:""},cancelText:{type:String,default:"取消"},confirmText:{type:String,default:"确认"},blur:{type:[Number,String],default:0}},data:()=>({popupValue:!1,defaultSelector:[0],columnData:[],selectValue:[],lastSelectIndex:[],columnNum:0,moving:!1,reset:!1}),watch:{valueCom:{immediate:!0,handler(e){e&&(this.reset=!0,setTimeout((()=>this.init()),10)),this.popupValue=e}}},computed:{uZIndex(){return this.zIndex?this.zIndex:this.$u.zIndex.popup},valueCom(){return this.modelValue},showColumnCom:()=>!0},methods:{pickstart(){},pickend(){},init(){this.reset=!1,this.setColumnNum(),this.setDefaultSelector(),this.setColumnData(),this.setSelectValue()},setDefaultSelector(){this.defaultSelector=this.defaultValue.length==this.columnNum?this.defaultValue:Array(this.columnNum).fill(0),this.lastSelectIndex=this.$u.deepClone(this.defaultSelector)},setColumnNum(){if("single-column"==this.mode)this.columnNum=1;else if("mutil-column"==this.mode)this.columnNum=this.list.length;else if("mutil-column-auto"==this.mode){let e=1,l=this.list;for(;l[0][this.childName];)l=l[0]?l[0][this.childName]:{},e++;this.columnNum=e}},setColumnData(){let e=[];if(this.selectValue=[],"mutil-column-auto"==this.mode){let l=this.list[this.defaultSelector.length?this.defaultSelector[0]:0];for(let t=0;t<this.columnNum;t++)0==t?(e[t]=this.list,l=l[this.childName]):(e[t]=l,l=l[this.defaultSelector[t]][this.childName])}else"single-column"==this.mode?e[0]=this.list:e=this.list;this.columnData=e},setSelectValue(){let e=null;for(let l=0;l<this.columnNum;l++){e=this.columnData[l][this.defaultSelector[l]];let t={index:this.defaultSelector[l],value:e?e[this.valueName]:null,label:e?e[this.labelName]:null};e&&void 0!==e.extra&&(t.extra=e.extra),this.selectValue.push(t)}},columnChange(e){let l=null,t=e.detail.value;if(this.selectValue=[],"mutil-column-auto"==this.mode){this.lastSelectIndex.map(((e,a)=>{e!=t[a]&&(l=a)})),this.defaultSelector=t;for(let e=l+1;e<this.columnNum;e++)this.columnData[e]=this.columnData[e-1][e-1==l?t[l]:0][this.childName],this.defaultSelector[e]=0;t.map(((e,l)=>{let a=this.columnData[l][t[l]],s={index:t[l],value:a?a[this.valueName]:null,label:a?a[this.labelName]:null};a&&void 0!==a.extra&&(s.extra=a.extra),this.selectValue.push(s)})),this.lastSelectIndex=t}else if("single-column"==this.mode){let e=this.columnData[0][t[0]],l={index:t[0],value:e?e[this.valueName]:null,label:e?e[this.labelName]:null};e&&void 0!==e.extra&&(l.extra=e.extra),this.selectValue.push(l),this.lastSelectIndex=t}else"mutil-column"==this.mode&&(t.map(((e,l)=>{let a=this.columnData[l][t[l]],s={index:t[l],value:a?a[this.valueName]:null,label:a?a[this.labelName]:null};a&&void 0!==a.extra&&(s.extra=a.extra),this.selectValue.push(s)})),this.lastSelectIndex=t)},close(){this.$emit("input",!1),this.$emit("update:modelValue",!1)},getResult(e=null){e&&this.$emit(e,this.selectValue),this.close()},selectHandler(){this.$emit("click")}}},[["render",function(_,v,y,b,g,k){const x=f,S=h,V=p,I=C(e("u-popup"),N);return l(),t(x,{class:"u-select"},{default:a((()=>[s(I,{blur:y.blur,maskCloseAble:y.maskCloseAble,mode:"bottom",popup:!1,modelValue:g.popupValue,"onUpdate:modelValue":v[4]||(v[4]=e=>g.popupValue=e),length:"auto",safeAreaInsetBottom:y.safeAreaInsetBottom,onClose:k.close,"z-index":k.uZIndex},{default:a((()=>[s(x,{class:"u-select"},{default:a((()=>[s(x,{class:"u-select__header",onTouchmove:v[3]||(v[3]=u((()=>{}),["stop","prevent"]))},{default:a((()=>[s(x,{class:"u-select__header__cancel u-select__header__btn",style:o({color:y.cancelColor}),"hover-class":"u-hover-class","hover-stay-time":150,onClick:v[0]||(v[0]=e=>k.getResult("cancel"))},{default:a((()=>[i(n(y.cancelText),1)])),_:1},8,["style"]),s(x,{class:"u-select__header__title"},{default:a((()=>[i(n(y.title),1)])),_:1}),s(x,{class:"u-select__header__confirm u-select__header__btn",style:o({color:g.moving?y.cancelColor:y.confirmColor}),"hover-class":"u-hover-class","hover-stay-time":150,onTouchmove:v[1]||(v[1]=u((()=>{}),["stop"])),onClick:v[2]||(v[2]=u((e=>k.getResult("confirm")),["stop"]))},{default:a((()=>[i(n(y.confirmText),1)])),_:1},8,["style"])])),_:1}),s(x,{class:"u-select__body"},{default:a((()=>[s(V,{onChange:k.columnChange,class:"u-select__body__picker-view",value:g.defaultSelector,onPickstart:k.pickstart,onPickend:k.pickend},{default:a((()=>[k.showColumnCom?(l(!0),c(d,{key:0},r(g.columnData,((e,u)=>(l(),t(S,{key:u},{default:a((()=>[(l(!0),c(d,null,r(e,((e,u)=>(l(),t(x,{class:"u-select__body__picker-view__item",key:u},{default:a((()=>[s(x,{class:"u-line-1"},{default:a((()=>[i(n(e[y.labelName]),1)])),_:2},1024)])),_:2},1024)))),128))])),_:2},1024)))),128)):m("",!0)])),_:1},8,["onChange","value","onPickstart","onPickend"])])),_:1})])),_:1})])),_:1},8,["blur","maskCloseAble","modelValue","safeAreaInsetBottom","onClose","z-index"])])),_:1})}],["__scopeId","data-v-eceb18cd"]]),D=I({__name:"addSquare",setup(u){S((()=>{U().then((e=>{r.value=e.result.rows,r.value.forEach(((e,l)=>{let t={value:e._id,label:e.name};d.value.push(t)}))}))}));const o=_("选择圈子"),c=_(!1),d=_([]),r=_({}),h=_({description:"默认圈子",name:"默认圈子",avatarUrl:null,backgroundUrl:null,parent_id:""});function p(){v({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(e){h.value.avatarUrl=e.tempFiles[0]}})}function N(){v({count:1,sizeType:["original","compressed"],sourceType:["album"],success:function(e){h.value.backgroundUrl=e.tempFiles[0]}})}function I(){c.value=!0}function D(e){console.log(e),h.value.parent_id=e[0].value,o.value=e[0].label}function z(){vk.checkToken()||vk.navigateTo("/pages/auth/auth"),function(e){const l=e.value;return Object.values(l).every((e=>null!=e&&""!==e&&!(Array.isArray(e)&&0===e.length)))}(h)?async function(){for(let e=0;e<2;e++)await vk.uploadFile({title:"图片上传中...",file:0==e?h.value.avatarUrl:h.value.backgroundUrl,success:l=>{let t=l.url;if(0==e){let e=[t];h.value.avatarUrl=e}else{let e=[t];h.value.backgroundUrl=e}},fail:e=>{}})}().then((e=>{T(h.value).then((e=>{vk.toast("申请圈子分类成功,等待管理员审核"),setTimeout((()=>{vk.navigateTo("/pages/square/square")}),1500),console.log(e)}))})):vk.toast("请检测所有带*的号是否输入完毕 包过头像和背景")}function j(){}return(u,r)=>{const _=y,v=f,S=C(e("uni-icons"),x),U=b,T=C(e("u-button"),V),B=g,w=k,R=C(e("u-select"),A);return l(),t(v,{class:"addSquare"},{default:a((()=>[s(v,{class:"addSquare-C"},{default:a((()=>[s(v,{class:"bj-C"},{default:a((()=>[s(v,{class:"bg"},{default:a((()=>[h.value.backgroundUrl?(l(),t(_,{key:0,mode:"aspectFill",src:h.value.backgroundUrl.path},null,8,["src"])):m("",!0)])),_:1}),s(v,{class:"avatar"},{default:a((()=>[s(v,{class:"avatar-C"},{default:a((()=>[s(v,{class:"avatar-I"},{default:a((()=>[h.value.avatarUrl?(l(),t(_,{key:1,mode:"aspectFill",src:h.value.avatarUrl.path},null,8,["src"])):(l(),t(v,{key:0,class:"icon"},{default:a((()=>[s(S,{type:"camera",size:"30"})])),_:1}))])),_:1}),s(v,{class:"info"},{default:a((()=>[s(v,{class:"title"},{default:a((()=>[i(n(h.value.name),1)])),_:1}),s(v,{class:"desc"},{default:a((()=>[i(n(h.value.description),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),s(v,{class:"infos"},{default:a((()=>[s(v,{class:"info-I"},{default:a((()=>[s(v,{class:"name"},{default:a((()=>[s(U,null,{default:a((()=>[i("*")])),_:1}),i("圈子头像:")])),_:1}),s(v,{class:"R"},{default:a((()=>[s(T,{onClick:p,size:"mini",type:"success"},{default:a((()=>[i("点击上传头像")])),_:1})])),_:1})])),_:1}),s(v,{class:"info-I"},{default:a((()=>[s(v,{class:"name"},{default:a((()=>[s(U,null,{default:a((()=>[i("*")])),_:1}),i("圈子背景:")])),_:1}),s(v,{class:"R"},{default:a((()=>[s(T,{onClick:N,size:"mini",type:"success"},{default:a((()=>[i("点击上传背景")])),_:1})])),_:1})])),_:1}),s(v,{class:"info-I"},{default:a((()=>[s(v,{class:"name"},{default:a((()=>[s(U,null,{default:a((()=>[i("*")])),_:1}),i("圈子名称:")])),_:1}),s(v,{class:"R"},{default:a((()=>[s(B,{modelValue:h.value.name,"onUpdate:modelValue":r[0]||(r[0]=e=>h.value.name=e),placeholder:"请输入圈子名称"},null,8,["modelValue"])])),_:1})])),_:1}),s(v,{class:"info-I"},{default:a((()=>[s(v,{class:"name"},{default:a((()=>[s(U,null,{default:a((()=>[i("*")])),_:1}),i("圈子简介:")])),_:1}),s(v,{class:"R"},{default:a((()=>[s(w,{modelValue:h.value.description,"onUpdate:modelValue":r[1]||(r[1]=e=>h.value.description=e),placeholder:"请输入圈子名称"},null,8,["modelValue"])])),_:1})])),_:1}),s(v,{class:"info-I",onClick:I},{default:a((()=>[s(v,{class:"name"},{default:a((()=>[s(U,null,{default:a((()=>[i("*")])),_:1}),i("选择父圈子:")])),_:1}),s(v,{class:"R tax"},{default:a((()=>[i(n(o.value)+"> ",1)])),_:1})])),_:1})])),_:1}),s(v,{class:"text"},{default:a((()=>[i(" 请认真仔细阅读"),s(U,null,{default:a((()=>[i("《圈主协议》")])),_:1}),i("，若所见圈子内涉及时政，色 情，暴力，无资质荐股，推币等违法内容传播，官方将立即永 久封停留子和账号，请各用户自觉博守国家法律和平台规则。 ")])),_:1}),s(v,{class:"btn"},{default:a((()=>[s(T,{onClick:z,type:"primary"},{default:a((()=>[i("申请创建")])),_:1})])),_:1}),s(R,{onCancel:j,onConfirm:D,modelValue:c.value,"onUpdate:modelValue":r[2]||(r[2]=e=>c.value=e),list:d.value},null,8,["modelValue","list"])])),_:1})])),_:1})}}},[["__scopeId","data-v-8821b5a6"]]);export{D as default};
