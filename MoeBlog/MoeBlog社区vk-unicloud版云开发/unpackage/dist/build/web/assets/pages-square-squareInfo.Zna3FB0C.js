import{p as e,d as a,a as s,w as l,o as u,b as t,f as r,k as o,t as n,h as i,j as d,F as c,l as f,i as v,m as _,v as p,S as m,u as g,x as k}from"./index-C69BgsYY.js";import{_ as q}from"./uni-icons.DbPdresR.js";import{o as x,a as y,b as j,c as I,r as h}from"./uni-app.es.4Bntlf4B.js";import{_ as C}from"./art-item.BNfpIJqP.js";import{_ as H}from"./z-paging.D7ASjMuL.js";import{u as U,a as V}from"./utils.qqFolnPJ.js";import{j as F,k as $,l as z,m as A,n as b}from"./api.ClmPzCnk.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./u-icon.yGbbo8IR.js";import"./u-action-sheet.CidrWLxj.js";import"./u-popup.CZC_HG1o.js";import"./square.DS5UtVkO.js";import"./like.DUCAGHvM.js";const w=S({__name:"squareInfo",setup(S){const{proxy:w}=k();x((e=>{E.value=e.id})),y((e=>{})),j((e=>{})),I((()=>{}));const B=e(null),E=e({id:""}),T=e({}),G=e([]),J=e(0),N=e(0),P=e([]),R=e(!1),D=e(null);function K(){let e={id:E.value,user_id:"_id"in vk.getVuex("$user.userInfo")?vk.getVuex("$user.userInfo")._id:""};z(e).then((e=>{T.value=e.result[0],N.value=e.result[0].fans_count,J.value=e.result[0].ArtCount,console.log(T.value),"FavoriteInfo"in T.value&&"_id"in T.value.FavoriteInfo?R.value=!0:R.value=!1}))}function L(e,a){K(),function(){let e={id:E.value,pageIndex:1};$(e).then((e=>{P.value=e.result.rows,console.log(P.value)}))}();let s={pageNo:e,pageSize:a,id:E.value};F(s).then((e=>{B.value.complete(e.result.rows)}))}function O(){if(R.value){console.log(T.value.FavoriteInfo);let e={_id:T.value.FavoriteInfo._id,user_id:vk.getVuex("$user.userInfo")._id,taxonomy_id:E.value},a=P.value.findIndex((e=>e._id===vk.getVuex("$user.userInfo")._id));P.value.splice(a,1),A(e).then((e=>{R.value=!1,N.value-=1}))}else{let e={_id:vk.getVuex("$user.userInfo")._id,username:U(vk.getVuex("$user.userInfo")),avatar:V(vk.getVuex("$user.userInfo"))};P.value.push(e),console.log(P.value),b({id:E.value,taxonomy_id:E.value}).then((e=>{R.value=!0,N.value+=1,D.value=e.result,setTimeout((()=>{K()}))}))}}function Q(){let e={_id:T.value._id,name:T.value.name},a=JSON.stringify(e);vk.navigateTo("/pages/art/addArt?item="+a)}return(e,k)=>{const x=f,y=v,j=_,I=h(a("uni-icons"),q),F=p,$=m,z=h(a("art-item"),C),A=h(a("z-paging"),H);return u(),s(A,{ref_key:"paging",ref:B,modelValue:G.value,"onUpdate:modelValue":k[1]||(k[1]=e=>G.value=e),onQuery:L},{default:l((()=>[t(y,{class:"square-info"},{default:l((()=>[t(y,{class:"square-C"},{default:l((()=>[t(y,{class:"square-H"},{default:l((()=>[t(y,{class:"square-H-bj"},{default:l((()=>[T.value.backgroundUrl?(u(),s(x,{key:0,mode:"aspectFill",src:T.value.backgroundUrl},null,8,["src"])):r("",!0)])),_:1}),t(y,{class:"square-H-C"},{default:l((()=>[t(y,{class:"avatar"},{default:l((()=>[T.value.avatarUrl?(u(),s(x,{key:0,mode:"aspectFill",src:T.value.avatarUrl},null,8,["src"])):r("",!0)])),_:1}),t(y,{class:"info"},{default:l((()=>[t(y,{class:"title"},{default:l((()=>[o(n(T.value.name),1)])),_:1}),t(y,{class:"desc"},{default:l((()=>[o(n(T.value.description),1)])),_:1})])),_:1})])),_:1}),t(y,{class:"square-H-B"},{default:l((()=>[t(y,{class:"square-H-B-L"},{default:l((()=>[t(j,null,{default:l((()=>[o(n(N.value)+"成员",1)])),_:1}),o(" · "),t(j,null,{default:l((()=>[o(n(J.value)+"条内容",1)])),_:1})])),_:1}),t(y,{class:"square-H-B-R"},{default:l((()=>[t(y,{class:"gz",onClick:O},{default:l((()=>[o(n(R.value?"已关注":"关注"),1)])),_:1}),t(y,{class:"share"},{default:l((()=>[t(F,{"open-type":"share"},{default:l((()=>[t(I,{type:"upload",size:"30",color:"#fff"})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),t(y,{class:"square-A"},{default:l((()=>[t(y,{class:"square-A-C"},{default:l((()=>[t(y,{class:"square-user"},{default:l((()=>[t(y,{class:"square-user-H"},{default:l((()=>[t(y,{class:"square-user-H-1"},{default:l((()=>[o("圈子成员")])),_:1}),t(y,{class:"square-user-H-2",onClick:k[0]||(k[0]=e=>{return a=T.value._id,vk.navigateTo("/pages/square/squareUser?id="+a),void console.log(a);var a})},{default:l((()=>[o("查看更多 >")])),_:1})])),_:1}),t(y,{class:"square-user-U"},{default:l((()=>[P.value.length>0?(u(),s($,{key:0,"scroll-x":"",class:"scroll-x"},{default:l((()=>[t(y,{class:"square-user-U-C"},{default:l((()=>[(u(!0),i(c,null,d(P.value,(e=>(u(),s(y,{class:"square-user-U-I",key:e._id,onClick:a=>{return s=e._id,void w.$framePostman.send({type:"USER_PAGE",id:s});var s}},{default:l((()=>[t(x,{mode:"aspectFill",src:g(V)(e)},null,8,["src"]),t(y,{class:"name"},{default:l((()=>[o(n(g(U)(e)),1)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})):(u(),s(y,{key:1,style:{padding:"25rpx",display:"flex","align-items":"center","justify-content":"center"}},{default:l((()=>[o(" 暂无用户关注 ")])),_:1}))])),_:1})])),_:1}),t(y,{class:"square-art"},{default:l((()=>[(u(!0),i(c,null,d(G.value,((e,a)=>(u(),s(z,{key:e._id,item:e},null,8,["item"])))),128))])),_:1})])),_:1})])),_:1})])),_:1}),t(y,{class:"add",onClick:Q},{default:l((()=>[o(" + ")])),_:1})])),_:1})])),_:1},8,["modelValue"])}}},[["__scopeId","data-v-dd09aa74"]]);export{w as default};
