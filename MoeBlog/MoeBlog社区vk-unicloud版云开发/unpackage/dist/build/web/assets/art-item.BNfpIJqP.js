import{p as e,C as t,d as a,o as s,h as i,b as l,w as o,s as r,u as c,k as m,t as n,a as u,e as d,F as f,j as _,f as v,y as p,l as g,i as x,Q as h,x as y}from"./index-C69BgsYY.js";import{_ as I}from"./u-icon.yGbbo8IR.js";import{r as k}from"./uni-app.es.4Bntlf4B.js";import{_ as b}from"./u-action-sheet.CidrWLxj.js";import{_ as j}from"./square.DS5UtVkO.js";import{_ as C,a as F,b as V}from"./like.DUCAGHvM.js";import{a as A,u as S,g as $}from"./utils.qqFolnPJ.js";import{F as q,G as T}from"./api.ClmPzCnk.js";import{_ as G}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=G({__name:"art-item",props:["item"],emits:["refresh"],setup(G,{emit:L}){const{proxy:P}=y(),R=L,U=e(!1),w=G,z=e(!1),E=e(0),J=e(null),K=e([{text:"编辑文章",disabled:w.item.user_id!=vk.getVuex("$user.userInfo")._id},{text:"删除文章",disabled:w.item.user_id!=vk.getVuex("$user.userInfo")._id,color:"#F44336"}]),O=e(!1);if(O.value=t.getCurrentUserInfo().role.indexOf("admin")>-1,O.value){let e=[{text:"审核通过",disabled:0==w.item.Audit},{text:"退回审核",disabled:2==w.item.Audit}];K.value.push(...e)}if(J.value=w.item.coverImg,w.item.coverImg.length>3){let e=w.item.coverImg.length;E.value=e,w.item.coverImg=w.item.coverImg.slice(0,3)}function Q(){z.value=!0}function B(){U.value=!0}function D(e){if(console.log(e),0==e&&vk.navigateTo("/pages/art/addArt?id="+w.item._id),1==e&&vk.confirm("确定删除文章?",(e=>{if(e.confirm){let e={user_id:vk.getVuex("$user.userInfo")._id,_id:w.item._id};q(e).then((e=>{let t=p();vk.redirectTo(t[0].$page.fullPath)}))}})),2==e){console.log("审核通过");let e={_id:w.item._id,Audit:0,taxonmoy_id:w.item.taxonmoy_id};T(e).then((e=>{R("refresh",!0),console.log(e)}))}if(3==e){let e={_id:w.item._id,Audit:2,taxonmoy_id:w.item.taxonmoy_id};T(e).then((e=>{R("refresh",!0),console.log(e)}))}}return(e,t)=>{const p=g,y=x,q=k(a("u-icon"),I),T=h,G=k(a("u-action-sheet"),b);return s(),i(f,null,[l(y,{class:"art-item",onClick:t[2]||(t[2]=e=>{return t=w.item._id,void vk.navigateTo("/pages/art/art?id="+t);var t})},{default:o((()=>[l(y,{class:"art-ctx"},{default:o((()=>[l(y,{class:"art-head"},{default:o((()=>[l(y,{class:"art-head-R"},{default:o((()=>[l(p,{onClick:t[0]||(t[0]=r((e=>{return t=w.item.userInfo._id,void P.$framePostman.send({type:"USER_PAGE",id:t});var t}),["stop"])),mode:"aspectFill",src:c(A)(w.item.userInfo)},null,8,["src"]),l(y,{class:"user"},{default:o((()=>[l(y,{class:"name"},{default:o((()=>[m(n(c(S)(w.item.userInfo)),1)])),_:1}),l(y,{class:"gxqm"},{default:o((()=>[m(n(c($)(w.item.userInfo)),1)])),_:1})])),_:1})])),_:1}),l(y,{class:"art-head-L"},{default:o((()=>[l(y,{class:"art-head-L-c",onClick:r(Q,["stop"])},{default:o((()=>[l(y,{class:"iconS"}),l(y,{class:"iconS"}),l(y,{class:"iconS"})])),_:1})])),_:1})])),_:1}),l(y,{class:"art-center"},{default:o((()=>[l(y,{class:"art-title"},{default:o((()=>[m(n(w.item.title),1)])),_:1}),l(y,{class:"art-desc"},{default:o((()=>[m(n(w.item.content),1)])),_:1}),0==w.item.coverVideo.length?(s(),u(y,{key:0,class:d(["art-C-img",1==w.item.coverImg.length?"imgStyle1":2==w.item.coverImg.length?"imgStyle2":"imgStyle3"])},{default:o((()=>[(s(!0),i(f,null,_(w.item.coverImg,((e,t)=>(s(),u(p,{mode:"aspectFill",src:e},null,8,["src"])))),256)),E.value>3?(s(),u(y,{key:0,class:"imgicon"},{default:o((()=>[l(q,{name:"photo"}),m(" "+n(E.value),1)])),_:1})):v("",!0)])),_:1},8,["class"])):(s(),u(y,{key:1,class:"art-C-tv"},{default:o((()=>[l(T,{onClick:r(B,["stop"]),autoplay:!1,"object-fit":"cover",src:w.item.coverVideo},null,8,["src"])])),_:1}))])),_:1}),l(y,{class:"art-bottom"},{default:o((()=>[w.item.taxonomy?(s(),u(y,{key:0,class:"category",onClick:t[1]||(t[1]=r((e=>{return t=w.item.taxonmoy_id,void vk.navigateTo("/pages/square/squareInfo?id="+t);var t}),["stop"]))},{default:o((()=>[l(y,{class:"category-icon"},{default:o((()=>[l(p,{mode:"aspectFill",src:j})])),_:1}),l(y,{class:"category-name"},{default:o((()=>[m(n(w.item.taxonomy.name),1)])),_:1})])),_:1})):v("",!0),l(y,{class:"art-info"},{default:o((()=>[l(y,{class:"art-info-C"},{default:o((()=>[l(y,{class:"art-info-R"},{default:o((()=>[m(n(w.item._add_time_str.slice(0,10)),1)])),_:1}),l(y,{class:"art-info-L"},{default:o((()=>[l(y,{class:"art-info-I"},{default:o((()=>[l(p,{mode:"aspectFill",src:C}),m(" "+n(w.item.view_count),1)])),_:1}),l(y,{class:"art-info-I"},{default:o((()=>[l(p,{mode:"aspectFill",src:F}),m(" "+n(w.item.comment_count),1)])),_:1}),l(y,{class:"art-info-I"},{default:o((()=>[l(p,{mode:"aspectFill",src:V}),m(" "+n(w.item.like_count),1)])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),l(G,{onClick:D,"safe-area-inset-bottom":!0,"z-index":"9999","border-radius":"25",list:K.value,modelValue:z.value,"onUpdate:modelValue":t[3]||(t[3]=e=>z.value=e)},null,8,["list","modelValue"])],64)}}},[["__scopeId","data-v-9550307b"]]);export{L as _};
