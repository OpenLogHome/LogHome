import{p as e,q as s,y as a,z as t,A as l,d as o,a as u,w as n,i as r,o as c,b as i,k as d,f as _,t as f,B as p}from"./index-C69BgsYY.js";import{_ as v}from"./uni-icons.DbPdresR.js";import{r as k}from"./uni-app.es.4Bntlf4B.js";import{_ as m}from"./_plugin-vue_export-helper.BCo6x5W8.js";const x=m({__name:"external_login",setup(m){const x=e(!0),g=e(!1),y=e(!1),h=e("");function b(){p({url:"/pages/auth/auth"})}return s((()=>{var e,s;const o=a(),u=null==(s=null==(e=o[o.length-1].$page)?void 0:e.options)?void 0:s.token;u?function(e){vk.userCenter.loginByCrossSite({data:{token:e},success:e=>{if(!e.token)throw new Error("获取登录令牌失败");{t("uni_id_token",e.token),t("uni_id_token_expired",e.tokenExpired);let s=vk.getVuex("$user.userInfo");vk.setVuex("$user.userInfo",{...s,...e.userInfo}),x.value=!1,g.value=!0,setTimeout((()=>{l({url:"/pages/index/index"})}),500)}},fail:e=>{console.error(e),x.value=!1,y.value=!0,h.value=e.msg||"登录令牌无效或已过期，请重新登录"}})}(u):(x.value=!1,y.value=!0,h.value="未接收到有效的登录信息")})),(e,s)=>{const a=r,t=k(o("uni-icons"),v);return c(),u(a,{class:"external-login"},{default:n((()=>[x.value?(c(),u(a,{key:0,class:"loading"},{default:n((()=>[i(a,{class:"spinner"},{default:n((()=>[i(a,{class:"bounce1"}),i(a,{class:"bounce2"}),i(a,{class:"bounce3"})])),_:1}),i(a,{class:"loading-text"},{default:n((()=>[d("登录中，请稍候...")])),_:1})])),_:1})):_("",!0),g.value?(c(),u(a,{key:1,class:"success"},{default:n((()=>[i(a,{class:"icon"},{default:n((()=>[i(t,{type:"checkmarkempty",size:"50",color:"#07C160"})])),_:1}),i(a,{class:"success-text"},{default:n((()=>[d("登录成功")])),_:1})])),_:1})):_("",!0),y.value?(c(),u(a,{key:2,class:"error"},{default:n((()=>[i(a,{class:"icon"},{default:n((()=>[i(t,{type:"closeempty",size:"50",color:"#FF0000"})])),_:1}),i(a,{class:"error-text"},{default:n((()=>[d("登录失败")])),_:1}),i(a,{class:"error-message"},{default:n((()=>[d(f(h.value),1)])),_:1}),i(a,{class:"button",onClick:b},{default:n((()=>[d("返回登录页")])),_:1})])),_:1})):_("",!0)])),_:1})}}},[["__scopeId","data-v-06c640c4"]]);export{x as default};
